
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>modelparameters.sympy.integrals.meijerint &#8212; modelparameters 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/nature.css" />
    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">modelparameters 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">modelparameters.sympy.integrals.meijerint</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for modelparameters.sympy.integrals.meijerint</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Integrate functions by rewriting them as Meijer G-functions.</span>

<span class="sd">There are three user-visible functions that can be used by other parts of the</span>
<span class="sd">sympy library to solve various integration problems:</span>

<span class="sd">- meijerint_indefinite</span>
<span class="sd">- meijerint_definite</span>
<span class="sd">- meijerint_inversion</span>

<span class="sd">They can be used to compute, respectively, indefinite integrals, definite</span>
<span class="sd">integrals over intervals of the real line, and inverse laplace-type integrals</span>
<span class="sd">(from c-I*oo to c+I*oo). See the respective docstrings for details.</span>

<span class="sd">The main references for this are:</span>

<span class="sd">[L] Luke, Y. L. (1969), The Special Functions and Their Approximations,</span>
<span class="sd">    Volume 1</span>

<span class="sd">[R] Kelly B. Roach.  Meijer G Function Representations.</span>
<span class="sd">    In: Proceedings of the 1997 International Symposium on Symbolic and</span>
<span class="sd">    Algebraic Computation, pages 205-211, New York, 1997. ACM.</span>

<span class="sd">[P] A. P. Prudnikov, Yu. A. Brychkov and O. I. Marichev (1990).</span>
<span class="sd">    Integrals and Series: More Special Functions, Vol. 3,.</span>
<span class="sd">    Gordon and Breach Science Publisher</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">division</span>

<span class="kn">from</span> <span class="nn">..core</span> <span class="kn">import</span> <span class="n">oo</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">Expr</span>
<span class="kn">from</span> <span class="nn">..core.exprtools</span> <span class="kn">import</span> <span class="n">factor_terms</span>
<span class="kn">from</span> <span class="nn">..core.function</span> <span class="kn">import</span> <span class="n">expand</span><span class="p">,</span> <span class="n">expand_mul</span><span class="p">,</span> <span class="n">expand_power_base</span>
<span class="kn">from</span> <span class="nn">..core.add</span> <span class="kn">import</span> <span class="n">Add</span>
<span class="kn">from</span> <span class="nn">..core.mul</span> <span class="kn">import</span> <span class="n">Mul</span>
<span class="kn">from</span> <span class="nn">..core.compatibility</span> <span class="kn">import</span> <span class="nb">range</span>
<span class="kn">from</span> <span class="nn">..core.cache</span> <span class="kn">import</span> <span class="n">cacheit</span>
<span class="kn">from</span> <span class="nn">..core.symbol</span> <span class="kn">import</span> <span class="n">Dummy</span><span class="p">,</span> <span class="n">Wild</span>
<span class="kn">from</span> <span class="nn">..simplify</span> <span class="kn">import</span> <span class="n">hyperexpand</span><span class="p">,</span> <span class="n">powdenest</span><span class="p">,</span> <span class="n">collect</span>
<span class="kn">from</span> <span class="nn">..logic.boolalg</span> <span class="kn">import</span> <span class="n">And</span><span class="p">,</span> <span class="n">Or</span><span class="p">,</span> <span class="n">BooleanAtom</span>
<span class="kn">from</span> <span class="nn">..functions.special.delta_functions</span> <span class="kn">import</span> <span class="n">Heaviside</span>
<span class="kn">from</span> <span class="nn">..functions.elementary.exponential</span> <span class="kn">import</span> <span class="n">exp</span>
<span class="kn">from</span> <span class="nn">..functions.elementary.piecewise</span> <span class="kn">import</span> <span class="n">Piecewise</span><span class="p">,</span> <span class="n">piecewise_fold</span>
<span class="kn">from</span> <span class="nn">..functions.elementary.hyperbolic</span> <span class="kn">import</span> \
    <span class="n">_rewrite_hyperbolics_as_exp</span><span class="p">,</span> <span class="n">HyperbolicFunction</span>
<span class="kn">from</span> <span class="nn">..functions.special.hyper</span> <span class="kn">import</span> <span class="n">meijerg</span>
<span class="kn">from</span> <span class="nn">..utilities.iterables</span> <span class="kn">import</span> <span class="n">multiset_partitions</span><span class="p">,</span> <span class="n">ordered</span>
<span class="kn">from</span> <span class="nn">..utilities.misc</span> <span class="kn">import</span> <span class="n">debug</span> <span class="k">as</span> <span class="n">_debug</span>
<span class="kn">from</span> <span class="nn">..utilities</span> <span class="kn">import</span> <span class="n">default_sort_key</span>

<span class="c1"># keep this at top for easy reference</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">Dummy</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_has</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="o">*</span><span class="n">f</span><span class="p">):</span>
    <span class="c1"># return True if res has f; in the case of Piecewise</span>
    <span class="c1"># only return True if *all* pieces have f</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">piecewise_fold</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="s1">&#39;is_Piecewise&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">_has</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">*</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="o">*</span><span class="n">f</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_create_lookup_table</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Add formulae for the function -&gt; meijerg lookup table. &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">wild</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Wild</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="n">z</span><span class="p">])</span>
    <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">wild</span><span class="p">,</span> <span class="s1">&#39;pqabc&#39;</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">Wild</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">is_Integer</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">z</span><span class="o">**</span><span class="n">q</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">an</span><span class="p">,</span> <span class="n">ap</span><span class="p">,</span> <span class="n">bm</span><span class="p">,</span> <span class="n">bq</span><span class="p">,</span> <span class="n">arg</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">fac</span><span class="o">=</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">cond</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">table</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">_mytype</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">formula</span><span class="p">,</span>
                                     <span class="p">[(</span><span class="n">fac</span><span class="p">,</span> <span class="n">meijerg</span><span class="p">(</span><span class="n">an</span><span class="p">,</span> <span class="n">ap</span><span class="p">,</span> <span class="n">bm</span><span class="p">,</span> <span class="n">bq</span><span class="p">,</span> <span class="n">arg</span><span class="p">))],</span> <span class="n">cond</span><span class="p">,</span> <span class="n">hint</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">addi</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">inst</span><span class="p">,</span> <span class="n">cond</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">table</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span>
            <span class="n">_mytype</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">formula</span><span class="p">,</span> <span class="n">inst</span><span class="p">,</span> <span class="n">cond</span><span class="p">,</span> <span class="n">hint</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">constant</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">a</span><span class="p">,</span> <span class="n">meijerg</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">z</span><span class="p">)),</span>
                <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">meijerg</span><span class="p">([],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[],</span> <span class="n">z</span><span class="p">))]</span>
    <span class="n">table</span><span class="p">[()]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span><span class="p">,</span> <span class="n">constant</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)]</span>

    <span class="c1"># [P], Section 8.</span>

    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">unpolarify</span><span class="p">,</span> <span class="n">Function</span><span class="p">,</span> <span class="n">Not</span>

    <span class="k">class</span> <span class="nc">IsNonPositiveInteger</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>

        <span class="nd">@classmethod</span>
        <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="n">unpolarify</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Integer</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">arg</span> <span class="o">&lt;=</span> <span class="mi">0</span>

    <span class="c1"># Section 8.4.2</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">re</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">sinc</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">sinh</span><span class="p">,</span> <span class="n">cosh</span><span class="p">,</span>
                       <span class="n">factorial</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">erf</span><span class="p">,</span> <span class="n">erfc</span><span class="p">,</span> <span class="n">erfi</span><span class="p">,</span> <span class="n">polar_lift</span><span class="p">)</span>
    <span class="c1"># TODO this needs more polar_lift (c/f entry for exp)</span>
    <span class="n">add</span><span class="p">(</span><span class="n">Heaviside</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="o">/</span><span class="n">b</span><span class="p">,</span>
        <span class="n">gamma</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">b</span><span class="o">**</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">And</span><span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">add</span><span class="p">(</span><span class="n">Heaviside</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[],</span> <span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[],</span> <span class="n">t</span><span class="o">/</span><span class="n">b</span><span class="p">,</span>
        <span class="n">gamma</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">b</span><span class="o">**</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">And</span><span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">add</span><span class="p">(</span><span class="n">Heaviside</span><span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="p">(</span><span class="n">b</span><span class="o">/</span><span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">q</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="o">/</span><span class="n">b</span><span class="p">,</span>
        <span class="n">gamma</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">b</span><span class="o">**</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">And</span><span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">add</span><span class="p">(</span><span class="n">Heaviside</span><span class="p">((</span><span class="n">b</span><span class="o">/</span><span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="n">z</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[],</span> <span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[],</span> <span class="n">t</span><span class="o">/</span><span class="n">b</span><span class="p">,</span>
        <span class="n">gamma</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">b</span><span class="o">**</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">And</span><span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">add</span><span class="p">((</span><span class="n">b</span> <span class="o">+</span> <span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[],</span> <span class="n">t</span><span class="o">/</span><span class="n">b</span><span class="p">,</span> <span class="n">b</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="n">gamma</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
        <span class="n">hint</span><span class="o">=</span><span class="n">Not</span><span class="p">(</span><span class="n">IsNonPositiveInteger</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>
    <span class="n">add</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">],</span> <span class="p">[(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">t</span><span class="o">/</span><span class="n">b</span><span class="p">,</span>
        <span class="mi">2</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">pi</span><span class="o">*</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">gamma</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">),</span> <span class="n">re</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">add</span><span class="p">((</span><span class="n">t</span><span class="o">**</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="o">**</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">b</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">],</span> <span class="p">[],</span> <span class="n">t</span><span class="o">/</span><span class="n">b</span><span class="p">,</span>
        <span class="n">b</span><span class="o">**</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span>

    <span class="c1"># 12</span>
    <span class="k">def</span> <span class="nf">A1</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">sign</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pi</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">sign</span><span class="o">*</span><span class="n">nu</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tmpadd</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">sgn</span><span class="p">):</span>
        <span class="c1"># XXX the a**2 is bad for matching</span>
        <span class="n">add</span><span class="p">((</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">sgn</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="n">b</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="n">r</span><span class="p">,</span>
            <span class="p">[(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">r</span> <span class="o">+</span> <span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[],</span>
            <span class="p">[(</span><span class="n">b</span> <span class="o">-</span> <span class="n">sgn</span><span class="o">*</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[(</span><span class="n">b</span> <span class="o">+</span> <span class="n">sgn</span><span class="o">*</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">t</span><span class="o">/</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">a</span><span class="o">**</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">A1</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">sgn</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
    <span class="n">tmpadd</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">tmpadd</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">tmpadd</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">tmpadd</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># 13</span>
    <span class="k">def</span> <span class="nf">tmpadd</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">sgn</span><span class="p">):</span>
        <span class="n">add</span><span class="p">((</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">p</span><span class="o">*</span><span class="n">z</span><span class="o">**</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">sgn</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">z</span><span class="o">**</span><span class="p">(</span><span class="n">q</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="n">b</span><span class="o">/</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">p</span><span class="o">*</span><span class="n">z</span><span class="o">**</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="n">r</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r</span> <span class="o">+</span> <span class="n">sgn</span><span class="o">*</span><span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r</span> <span class="o">-</span> <span class="n">sgn</span><span class="o">*</span><span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[],</span>
            <span class="n">p</span><span class="o">*</span><span class="n">z</span><span class="o">**</span><span class="n">q</span><span class="o">/</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="o">**</span><span class="p">(</span><span class="n">b</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">A1</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">sgn</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
    <span class="n">tmpadd</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">tmpadd</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">tmpadd</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">tmpadd</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># (those after look obscure)</span>

    <span class="c1"># Section 8.4.3</span>
    <span class="n">add</span><span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="n">polar_lift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">),</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[])</span>

    <span class="c1"># TODO can do sin^n, sinh^n by expansion ... where?</span>
    <span class="c1"># 8.4.4 (hyperbolic functions)</span>
    <span class="n">add</span><span class="p">(</span><span class="n">sinh</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="p">[],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">pi</span><span class="o">**</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">add</span><span class="p">(</span><span class="n">cosh</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="p">[],</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">pi</span><span class="o">**</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>

    <span class="c1"># Section 8.4.5</span>
    <span class="c1"># TODO can do t + a. but can also do by expansion... (XXX not really)</span>
    <span class="n">add</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span>
    <span class="n">add</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span>

    <span class="c1"># Section 8.4.6 (sinc function)</span>
    <span class="n">add</span><span class="p">(</span><span class="n">sinc</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Section 8.5.5</span>
    <span class="k">def</span> <span class="nf">make_log1</span><span class="p">(</span><span class="n">subs</span><span class="p">):</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">subs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[((</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">N</span><span class="o">*</span><span class="n">factorial</span><span class="p">(</span><span class="n">N</span><span class="p">),</span>
                 <span class="n">meijerg</span><span class="p">([],</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[],</span> <span class="n">t</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">make_log2</span><span class="p">(</span><span class="n">subs</span><span class="p">):</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">subs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">factorial</span><span class="p">(</span><span class="n">N</span><span class="p">),</span>
                 <span class="n">meijerg</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">t</span><span class="p">))]</span>
    <span class="c1"># TODO these only hold for positive p, and can be made more general</span>
    <span class="c1">#      but who uses log(x)*Heaviside(a-x) anyway ...</span>
    <span class="c1"># TODO also it would be nice to derive them recursively ...</span>
    <span class="n">addi</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="n">n</span><span class="o">*</span><span class="n">Heaviside</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">),</span> <span class="n">make_log1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">addi</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="n">n</span><span class="o">*</span><span class="n">Heaviside</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">make_log2</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">make_log3</span><span class="p">(</span><span class="n">subs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">make_log1</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span> <span class="o">+</span> <span class="n">make_log2</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span>
    <span class="n">addi</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="n">n</span><span class="p">,</span> <span class="n">make_log3</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">addi</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">a</span><span class="p">),</span>
         <span class="n">constant</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="o">+</span> <span class="p">[(</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">meijerg</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="o">/</span><span class="n">a</span><span class="p">))],</span>
         <span class="kc">True</span><span class="p">)</span>
    <span class="n">addi</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">a</span><span class="p">)),</span> <span class="n">constant</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span> <span class="o">+</span>
         <span class="p">[(</span><span class="n">pi</span><span class="p">,</span> <span class="n">meijerg</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">t</span><span class="o">/</span><span class="n">a</span><span class="p">))],</span>
         <span class="kc">True</span><span class="p">)</span>
    <span class="c1"># TODO log(x)/(x+a) and log(x)/(x-1) can also be done. should they</span>
    <span class="c1">#      be derivable?</span>
    <span class="c1"># TODO further formulae in this section seem obscure</span>

    <span class="c1"># Sections 8.4.9-10</span>
    <span class="c1"># TODO</span>

    <span class="c1"># Section 8.4.11</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">Ei</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">expint</span><span class="p">,</span> <span class="n">Si</span><span class="p">,</span> <span class="n">Ci</span><span class="p">,</span> <span class="n">Shi</span><span class="p">,</span> <span class="n">Chi</span><span class="p">,</span> <span class="n">fresnels</span><span class="p">,</span> <span class="n">fresnelc</span>
    <span class="n">addi</span><span class="p">(</span><span class="n">Ei</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>
         <span class="n">constant</span><span class="p">(</span><span class="o">-</span><span class="n">I</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="p">[(</span><span class="n">S</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">meijerg</span><span class="p">([],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[],</span>
                  <span class="n">t</span><span class="o">*</span><span class="n">polar_lift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)))],</span>
         <span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Section 8.4.12</span>
    <span class="n">add</span><span class="p">(</span><span class="n">Si</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">add</span><span class="p">(</span><span class="n">Ci</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="p">[],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Section 8.4.13</span>
    <span class="n">add</span><span class="p">(</span><span class="n">Shi</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">S</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">polar_lift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">t</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">add</span><span class="p">(</span><span class="n">Chi</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="p">[],</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span>
        <span class="n">pi</span><span class="o">**</span><span class="n">S</span><span class="p">(</span><span class="s1">&#39;3/2&#39;</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># generalized exponential integral</span>
    <span class="n">add</span><span class="p">(</span><span class="n">expint</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="p">[],</span> <span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="p">[</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[],</span> <span class="n">t</span><span class="p">)</span>

    <span class="c1"># Section 8.4.14</span>
    <span class="n">add</span><span class="p">(</span><span class="n">erf</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span>
    <span class="c1"># TODO exp(-x)*erf(I*x) does not work</span>
    <span class="n">add</span><span class="p">(</span><span class="n">erfc</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="p">[],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[],</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span>
    <span class="c1"># This formula for erfi(z) yields a wrong(?) minus sign</span>
    <span class="c1">#add(erfi(t), [1], [], [S(1)/2], [0], -t**2, I/sqrt(pi))</span>
    <span class="n">add</span><span class="p">(</span><span class="n">erfi</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="o">-</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">t</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span>

    <span class="c1"># Fresnel Integrals</span>
    <span class="n">add</span><span class="p">(</span><span class="n">fresnels</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">],</span> <span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mi">4</span><span class="o">/</span><span class="mi">16</span><span class="p">,</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">add</span><span class="p">(</span><span class="n">fresnelc</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">S</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">],</span> <span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mi">4</span><span class="o">/</span><span class="mi">16</span><span class="p">,</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1">##### bessel-type functions #####</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">besselj</span><span class="p">,</span> <span class="n">bessely</span><span class="p">,</span> <span class="n">besseli</span><span class="p">,</span> <span class="n">besselk</span>

    <span class="c1"># Section 8.4.19</span>
    <span class="n">add</span><span class="p">(</span><span class="n">besselj</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>

    <span class="c1"># all of the following are derivable</span>
    <span class="c1">#add(sin(t)*besselj(a, t), [S(1)/4, S(3)/4], [], [(1+a)/2],</span>
    <span class="c1">#    [-a/2, a/2, (1-a)/2], t**2, 1/sqrt(2))</span>
    <span class="c1">#add(cos(t)*besselj(a, t), [S(1)/4, S(3)/4], [], [a/2],</span>
    <span class="c1">#    [-a/2, (1+a)/2, (1-a)/2], t**2, 1/sqrt(2))</span>
    <span class="c1">#add(besselj(a, t)**2, [S(1)/2], [], [a], [-a, 0], t**2, 1/sqrt(pi))</span>
    <span class="c1">#add(besselj(a, t)*besselj(b, t), [0, S(1)/2], [], [(a + b)/2],</span>
    <span class="c1">#    [-(a+b)/2, (a - b)/2, (b - a)/2], t**2, 1/sqrt(pi))</span>

    <span class="c1"># Section 8.4.20</span>
    <span class="n">add</span><span class="p">(</span><span class="n">bessely</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="p">[],</span> <span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>

    <span class="c1"># TODO all of the following should be derivable</span>
    <span class="c1">#add(sin(t)*bessely(a, t), [S(1)/4, S(3)/4], [(1 - a - 1)/2],</span>
    <span class="c1">#    [(1 + a)/2, (1 - a)/2], [(1 - a - 1)/2, (1 - 1 - a)/2, (1 - 1 + a)/2],</span>
    <span class="c1">#    t**2, 1/sqrt(2))</span>
    <span class="c1">#add(cos(t)*bessely(a, t), [S(1)/4, S(3)/4], [(0 - a - 1)/2],</span>
    <span class="c1">#    [(0 + a)/2, (0 - a)/2], [(0 - a - 1)/2, (1 - 0 - a)/2, (1 - 0 + a)/2],</span>
    <span class="c1">#    t**2, 1/sqrt(2))</span>
    <span class="c1">#add(besselj(a, t)*bessely(b, t), [0, S(1)/2], [(a - b - 1)/2],</span>
    <span class="c1">#    [(a + b)/2, (a - b)/2], [(a - b - 1)/2, -(a + b)/2, (b - a)/2],</span>
    <span class="c1">#    t**2, 1/sqrt(pi))</span>
    <span class="c1">#addi(bessely(a, t)**2,</span>
    <span class="c1">#     [(2/sqrt(pi), meijerg([], [S(1)/2, S(1)/2 - a], [0, a, -a],</span>
    <span class="c1">#                           [S(1)/2 - a], t**2)),</span>
    <span class="c1">#      (1/sqrt(pi), meijerg([S(1)/2], [], [a], [-a, 0], t**2))],</span>
    <span class="c1">#     True)</span>
    <span class="c1">#addi(bessely(a, t)*bessely(b, t),</span>
    <span class="c1">#     [(2/sqrt(pi), meijerg([], [0, S(1)/2, (1 - a - b)/2],</span>
    <span class="c1">#                           [(a + b)/2, (a - b)/2, (b - a)/2, -(a + b)/2],</span>
    <span class="c1">#                           [(1 - a - b)/2], t**2)),</span>
    <span class="c1">#      (1/sqrt(pi), meijerg([0, S(1)/2], [], [(a + b)/2],</span>
    <span class="c1">#                           [-(a + b)/2, (a - b)/2, (b - a)/2], t**2))],</span>
    <span class="c1">#     True)</span>

    <span class="c1"># Section 8.4.21 ?</span>
    <span class="c1"># Section 8.4.22</span>
    <span class="n">add</span><span class="p">(</span><span class="n">besseli</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="p">[],</span> <span class="p">[(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">pi</span><span class="p">)</span>
    <span class="c1"># TODO many more formulas. should all be derivable</span>

    <span class="c1"># Section 8.4.23</span>
    <span class="n">add</span><span class="p">(</span><span class="n">besselk</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[],</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1"># TODO many more formulas. should all be derivable</span>

    <span class="c1"># Complete elliptic integrals K(z) and E(z)</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">elliptic_k</span><span class="p">,</span> <span class="n">elliptic_e</span>
    <span class="n">add</span><span class="p">(</span><span class="n">elliptic_k</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="p">[</span><span class="n">S</span><span class="o">.</span><span class="n">Half</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">Half</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">t</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">Half</span><span class="p">)</span>
    <span class="n">add</span><span class="p">(</span><span class="n">elliptic_e</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="p">[</span><span class="n">S</span><span class="o">.</span><span class="n">Half</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">S</span><span class="o">.</span><span class="n">Half</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">t</span><span class="p">,</span> <span class="o">-</span><span class="n">S</span><span class="o">.</span><span class="n">Half</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>


<span class="c1">####################################################################</span>
<span class="c1"># First some helper functions.</span>
<span class="c1">####################################################################</span>

<span class="kn">from</span> <span class="nn">..utilities.timeutils</span> <span class="kn">import</span> <span class="n">timethis</span>
<span class="n">timeit</span> <span class="o">=</span> <span class="n">timethis</span><span class="p">(</span><span class="s1">&#39;meijerg&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_mytype</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create a hashable entity describing the type of f. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">()</span>
    <span class="k">elif</span> <span class="n">f</span><span class="o">.</span><span class="n">is_Function</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">f</span><span class="p">),)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_mytype</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">res</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_CoeffExpValueError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exception raised by _get_coeff_exp, for internal use only.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>


<span class="k">def</span> <span class="nf">_get_coeff_exp</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    When expr is known to be of the form c*x**b, with c and/or b possibly 1,</span>
<span class="sd">    return c, b.</span>

<span class="sd">    &gt;&gt;&gt; from ..abc import x, a, b</span>
<span class="sd">    &gt;&gt;&gt; from .meijerint import _get_coeff_exp</span>
<span class="sd">    &gt;&gt;&gt; _get_coeff_exp(a*x**b, x)</span>
<span class="sd">    (a, b)</span>
<span class="sd">    &gt;&gt;&gt; _get_coeff_exp(x, x)</span>
<span class="sd">    (1, 1)</span>
<span class="sd">    &gt;&gt;&gt; _get_coeff_exp(2*x, x)</span>
<span class="sd">    (2, 1)</span>
<span class="sd">    &gt;&gt;&gt; _get_coeff_exp(x**3, x)</span>
<span class="sd">    (1, 3)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">powsimp</span>
    <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="o">=</span> <span class="n">expand_power_base</span><span class="p">(</span><span class="n">powsimp</span><span class="p">(</span><span class="n">expr</span><span class="p">))</span><span class="o">.</span><span class="n">as_coeff_mul</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">c</span><span class="p">,</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
    <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">is_Pow</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">base</span> <span class="o">!=</span> <span class="n">x</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">_CoeffExpValueError</span><span class="p">(</span><span class="s1">&#39;expr not of form a*x**b&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">c</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">exp</span>
    <span class="k">elif</span> <span class="n">m</span> <span class="o">==</span> <span class="n">x</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">c</span><span class="p">,</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">_CoeffExpValueError</span><span class="p">(</span><span class="s1">&#39;expr not of form a*x**b: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">expr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_exponents</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the exponents of ``x`` (not including zero) in ``expr``.</span>

<span class="sd">    &gt;&gt;&gt; from .meijerint import _exponents</span>
<span class="sd">    &gt;&gt;&gt; from ..abc import x, y</span>
<span class="sd">    &gt;&gt;&gt; from .. import sin</span>
<span class="sd">    &gt;&gt;&gt; _exponents(x, x)</span>
<span class="sd">    {1}</span>
<span class="sd">    &gt;&gt;&gt; _exponents(x**2, x)</span>
<span class="sd">    {2}</span>
<span class="sd">    &gt;&gt;&gt; _exponents(x**2 + x, x)</span>
<span class="sd">    {1, 2}</span>
<span class="sd">    &gt;&gt;&gt; _exponents(x**3*sin(x + x**y) + 1/x, x)</span>
<span class="sd">    {-1, 1, 3, y}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_exponents_</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">expr</span> <span class="o">==</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">res</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_Pow</span> <span class="ow">and</span> <span class="n">expr</span><span class="o">.</span><span class="n">base</span> <span class="o">==</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">res</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">expr</span><span class="o">.</span><span class="n">exp</span><span class="p">])</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="n">_exponents_</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">_exponents_</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>


<span class="k">def</span> <span class="nf">_functions</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Find the types of functions in expr, to estimate the complexity. &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">Function</span>
    <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">func</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">atoms</span><span class="p">(</span><span class="n">Function</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_find_splitting_points</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find numbers a such that a linear substitution x -&gt; x + a would</span>
<span class="sd">    (hopefully) simplify expr.</span>

<span class="sd">    &gt;&gt;&gt; from .meijerint import _find_splitting_points as fsp</span>
<span class="sd">    &gt;&gt;&gt; from .. import sin</span>
<span class="sd">    &gt;&gt;&gt; from ..abc import a, x</span>
<span class="sd">    &gt;&gt;&gt; fsp(x, x)</span>
<span class="sd">    {0}</span>
<span class="sd">    &gt;&gt;&gt; fsp((x-1)**3, x)</span>
<span class="sd">    {1}</span>
<span class="sd">    &gt;&gt;&gt; fsp(sin(x+3)*x, x)</span>
<span class="sd">    {-3, 0}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="n">Wild</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="s1">&#39;pq&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">compute_innermost</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">Expr</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span> <span class="ow">and</span> <span class="n">m</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">res</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">-</span><span class="n">m</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="o">/</span><span class="n">m</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_Atom</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="n">compute_innermost</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
    <span class="n">innermost</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">compute_innermost</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">innermost</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">innermost</span>


<span class="k">def</span> <span class="nf">_split_mul</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Split expression ``f`` into fac, po, g, where fac is a constant factor,</span>
<span class="sd">    po = x**s for some s independent of s, and g is &quot;the rest&quot;.</span>

<span class="sd">    &gt;&gt;&gt; from .meijerint import _split_mul</span>
<span class="sd">    &gt;&gt;&gt; from .. import sin</span>
<span class="sd">    &gt;&gt;&gt; from ..abc import s, x</span>
<span class="sd">    &gt;&gt;&gt; _split_mul((3*x)**s*sin(x**2)*x, x)</span>
<span class="sd">    (3**s, x*x**s, sin(x**2))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">polarify</span><span class="p">,</span> <span class="n">unpolarify</span>
    <span class="n">fac</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">po</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">expand_power_base</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">Mul</span><span class="o">.</span><span class="n">make_args</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">po</span> <span class="o">*=</span> <span class="n">x</span>
        <span class="k">elif</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">:</span>
            <span class="n">fac</span> <span class="o">*=</span> <span class="n">a</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">is_Pow</span> <span class="ow">and</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">:</span>
                <span class="n">c</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">as_coeff_mul</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="p">(</span><span class="n">x</span><span class="p">,):</span>
                    <span class="n">c</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">expand_mul</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">base</span><span class="p">)</span><span class="o">.</span><span class="n">as_coeff_mul</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="p">(</span><span class="n">x</span><span class="p">,):</span>
                    <span class="n">po</span> <span class="o">*=</span> <span class="n">x</span><span class="o">**</span><span class="n">a</span><span class="o">.</span><span class="n">exp</span>
                    <span class="n">fac</span> <span class="o">*=</span> <span class="n">unpolarify</span><span class="p">(</span><span class="n">polarify</span><span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="n">a</span><span class="o">.</span><span class="n">exp</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
                    <span class="k">continue</span>
            <span class="n">g</span> <span class="o">*=</span> <span class="n">a</span>

    <span class="k">return</span> <span class="n">fac</span><span class="p">,</span> <span class="n">po</span><span class="p">,</span> <span class="n">g</span>


<span class="k">def</span> <span class="nf">_mul_args</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a list ``L`` such that Mul(*L) == f.</span>

<span class="sd">    If f is not a Mul or Pow, L=[f].</span>
<span class="sd">    If f=g**n for an integer n, L=[g]*n.</span>
<span class="sd">    If f is a Mul, L comes from applying _mul_args to all factors of f.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">Mul</span><span class="o">.</span><span class="n">make_args</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">is_Pow</span> <span class="ow">and</span> <span class="n">g</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">is_Integer</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">exp</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">base</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="n">n</span>
                <span class="n">base</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">base</span>
            <span class="n">gs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">base</span><span class="p">]</span><span class="o">*</span><span class="n">n</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gs</span>


<span class="k">def</span> <span class="nf">_mul_as_two_parts</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find all the ways to split f into a product of two terms.</span>
<span class="sd">    Return None on failure.</span>

<span class="sd">    Although the order is canonical from multiset_partitions, this is</span>
<span class="sd">    not necessarily the best order to process the terms. For example,</span>
<span class="sd">    if the case of len(gs) == 2 is removed and multiset is allowed to</span>
<span class="sd">    sort the terms, some tests fail.</span>

<span class="sd">    &gt;&gt;&gt; from .meijerint import _mul_as_two_parts</span>
<span class="sd">    &gt;&gt;&gt; from .. import sin, exp, ordered</span>
<span class="sd">    &gt;&gt;&gt; from ..abc import x</span>
<span class="sd">    &gt;&gt;&gt; list(ordered(_mul_as_two_parts(x*sin(x)*exp(x))))</span>
<span class="sd">    [(x, exp(x)*sin(x)), (x*exp(x), sin(x)), (x*sin(x), exp(x))]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">gs</span> <span class="o">=</span> <span class="n">_mul_args</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">gs</span><span class="p">)]</span>
    <span class="k">return</span> <span class="p">[(</span><span class="n">Mul</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">),</span> <span class="n">Mul</span><span class="p">(</span><span class="o">*</span><span class="n">y</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="n">multiset_partitions</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>


<span class="k">def</span> <span class="nf">_inflate_g</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Return C, h such that h is a G function of argument z**n and</span>
<span class="sd">        g = C*h. &quot;&quot;&quot;</span>
    <span class="c1"># TODO should this be a method of meijerg?</span>
    <span class="c1"># See: [L, page 150, equation (5)]</span>
    <span class="k">def</span> <span class="nf">inflate</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; (a1, .., ak) -&gt; (a1/n, (a1+1)/n, ..., (ak + n-1)/n) &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">a</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ap</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">bq</span><span class="p">))</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">n</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">nu</span> <span class="o">+</span> <span class="n">v</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">C</span> <span class="o">/=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="p">((</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">g</span><span class="o">.</span><span class="n">delta</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">C</span><span class="p">,</span> <span class="n">meijerg</span><span class="p">(</span><span class="n">inflate</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">an</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">inflate</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">aother</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span>
                      <span class="n">inflate</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">bm</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">inflate</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">bother</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span>
                      <span class="n">g</span><span class="o">.</span><span class="n">argument</span><span class="o">**</span><span class="n">n</span> <span class="o">*</span> <span class="n">n</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">v</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_flip_g</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Turn the G function into one of inverse argument</span>
<span class="sd">        (i.e. G(1/x) -&gt; G&#39;(x)) &quot;&quot;&quot;</span>
    <span class="c1"># See [L], section 5.2</span>
    <span class="k">def</span> <span class="nf">tr</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">meijerg</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">bm</span><span class="p">),</span> <span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">bother</span><span class="p">),</span> <span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">an</span><span class="p">),</span> <span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">aother</span><span class="p">),</span> <span class="mi">1</span><span class="o">/</span><span class="n">g</span><span class="o">.</span><span class="n">argument</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_inflate_fox_h</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Let d denote the integrand in the definition of the G function ``g``.</span>
<span class="sd">    Consider the function H which is defined in the same way, but with</span>
<span class="sd">    integrand d/Gamma(a*s) (contour conventions as usual).</span>

<span class="sd">    If a is rational, the function H can be written as C*G, for a constant C</span>
<span class="sd">    and a G-function G.</span>

<span class="sd">    This function returns C, G.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_inflate_fox_h</span><span class="p">(</span><span class="n">_flip_g</span><span class="p">(</span><span class="n">g</span><span class="p">),</span> <span class="o">-</span><span class="n">a</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
    <span class="c1"># We use the substitution s-&gt;qs, i.e. inflate g by q. We are left with an</span>
    <span class="c1"># extra factor of Gamma(p*s), for which we use Gauss&#39; multiplication</span>
    <span class="c1"># theorem.</span>
    <span class="n">D</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">_inflate_g</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">argument</span>
    <span class="n">D</span> <span class="o">/=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">/=</span> <span class="n">p</span><span class="o">**</span><span class="n">p</span>
    <span class="n">bs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">p</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">D</span><span class="p">,</span> <span class="n">meijerg</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">an</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">aother</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">bm</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">bother</span><span class="p">)</span> <span class="o">+</span> <span class="n">bs</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>

<span class="n">_dummies</span> <span class="o">=</span> <span class="p">{}</span>


<span class="k">def</span> <span class="nf">_dummy</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a dummy. This will return the same dummy if the same token+name is</span>
<span class="sd">    requested more than once, and it is not already in expr.</span>
<span class="sd">    This is for being cache-friendly.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">_dummy_</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Dummy</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>


<span class="k">def</span> <span class="nf">_dummy_</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a dummy associated to name and token. Same effect as declaring</span>
<span class="sd">    it globally.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_dummies</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span> <span class="ow">in</span> <span class="n">_dummies</span><span class="p">:</span>
        <span class="n">_dummies</span><span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="n">token</span><span class="p">)]</span> <span class="o">=</span> <span class="n">Dummy</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_dummies</span><span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="n">token</span><span class="p">)]</span>


<span class="k">def</span> <span class="nf">_is_analytic</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Check if f(x), when expressed using G functions on the positive reals,</span>
<span class="sd">        will in fact agree with the G functions almost everywhere &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">Heaviside</span><span class="p">,</span> <span class="n">Abs</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">free_symbols</span> <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">atoms</span><span class="p">(</span><span class="n">Heaviside</span><span class="p">,</span> <span class="n">Abs</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_condsimp</span><span class="p">(</span><span class="n">cond</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Do naive simplifications on ``cond``.</span>

<span class="sd">    Note that this routine is completely ad-hoc, simplification rules being</span>
<span class="sd">    added as need arises rather than following any logical pattern.</span>

<span class="sd">    &gt;&gt;&gt; from .meijerint import _condsimp as simp</span>
<span class="sd">    &gt;&gt;&gt; from .. import Or, Eq, unbranched_argument as arg, And</span>
<span class="sd">    &gt;&gt;&gt; from ..abc import x, y, z</span>
<span class="sd">    &gt;&gt;&gt; simp(Or(x &lt; y, z, Eq(x, y)))</span>
<span class="sd">    z | (x &lt;= y)</span>
<span class="sd">    &gt;&gt;&gt; simp(Or(x &lt;= y, And(x &lt; y, z)))</span>
<span class="sd">    x &lt;= y</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">symbols</span><span class="p">,</span> <span class="n">Wild</span><span class="p">,</span> <span class="n">Eq</span><span class="p">,</span> <span class="n">unbranched_argument</span><span class="p">,</span> <span class="n">exp_polar</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span>
        <span class="n">periodic_argument</span><span class="p">,</span> <span class="n">oo</span><span class="p">,</span> <span class="n">polar_lift</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">..logic.boolalg</span> <span class="kn">import</span> <span class="n">BooleanFunction</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">BooleanFunction</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cond</span>
    <span class="n">cond</span> <span class="o">=</span> <span class="n">cond</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">_condsimp</span><span class="p">,</span> <span class="n">cond</span><span class="o">.</span><span class="n">args</span><span class="p">)))</span>
    <span class="n">change</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;p q r&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">Wild</span><span class="p">)</span>
    <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">Or</span><span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">,</span> <span class="n">Eq</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)),</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="n">q</span><span class="p">),</span>
        <span class="c1"># The next two obviously are instances of a general pattern, but it is</span>
        <span class="c1"># easier to spell out the few cases we care about.</span>
        <span class="p">(</span><span class="n">And</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">unbranched_argument</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">pi</span><span class="p">,</span>
           <span class="nb">abs</span><span class="p">(</span><span class="n">unbranched_argument</span><span class="p">(</span><span class="n">exp_polar</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">pi</span><span class="p">),</span>
       <span class="n">Eq</span><span class="p">(</span><span class="n">unbranched_argument</span><span class="p">(</span><span class="n">exp_polar</span><span class="p">(</span><span class="o">-</span><span class="n">I</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="p">),</span> <span class="mi">0</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">And</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">unbranched_argument</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
           <span class="nb">abs</span><span class="p">(</span><span class="n">unbranched_argument</span><span class="p">(</span><span class="n">exp_polar</span><span class="p">(</span><span class="o">-</span><span class="n">pi</span><span class="o">*</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span>
       <span class="n">Eq</span><span class="p">(</span><span class="n">unbranched_argument</span><span class="p">(</span><span class="n">exp_polar</span><span class="p">(</span><span class="o">-</span><span class="n">I</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="p">),</span> <span class="mi">0</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">Or</span><span class="p">(</span><span class="n">p</span> <span class="o">&lt;=</span> <span class="n">q</span><span class="p">,</span> <span class="n">And</span><span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">,</span> <span class="n">r</span><span class="p">)),</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="n">q</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">while</span> <span class="n">change</span><span class="p">:</span>
        <span class="n">change</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">fro</span><span class="p">,</span> <span class="n">to</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fro</span><span class="o">.</span><span class="n">func</span> <span class="o">!=</span> <span class="n">cond</span><span class="o">.</span><span class="n">func</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">args</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">fro</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">fro</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">num</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">fro</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">otherargs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fro</span><span class="o">.</span><span class="n">args</span><span class="p">[:</span><span class="n">num</span><span class="p">]</span> <span class="o">+</span> <span class="n">fro</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="n">num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]]</span>
                <span class="n">otherlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">arg2</span> <span class="ow">in</span> <span class="n">otherargs</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">arg3</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">args</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">otherlist</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="k">if</span> <span class="n">arg2</span> <span class="o">==</span> <span class="n">arg3</span><span class="p">:</span>
                            <span class="n">otherlist</span> <span class="o">+=</span> <span class="p">[</span><span class="n">k</span><span class="p">]</span>
                            <span class="k">break</span>
                        <span class="k">if</span> <span class="n">arg3</span><span class="o">.</span><span class="n">func</span> <span class="ow">is</span> <span class="n">And</span> <span class="ow">and</span> <span class="n">arg2</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">r</span> <span class="ow">and</span> \
                                <span class="n">arg2</span><span class="o">.</span><span class="n">func</span> <span class="ow">is</span> <span class="n">And</span> <span class="ow">and</span> <span class="n">arg2</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">arg3</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
                            <span class="n">otherlist</span> <span class="o">+=</span> <span class="p">[</span><span class="n">k</span><span class="p">]</span>
                            <span class="k">break</span>
                        <span class="k">if</span> <span class="n">arg3</span><span class="o">.</span><span class="n">func</span> <span class="ow">is</span> <span class="n">And</span> <span class="ow">and</span> <span class="n">arg2</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">r</span> <span class="ow">and</span> \
                                <span class="n">arg2</span><span class="o">.</span><span class="n">func</span> <span class="ow">is</span> <span class="n">And</span> <span class="ow">and</span> <span class="n">arg2</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">arg3</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
                            <span class="n">otherlist</span> <span class="o">+=</span> <span class="p">[</span><span class="n">k</span><span class="p">]</span>
                            <span class="k">break</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">otherlist</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">otherargs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">newargs</span> <span class="o">=</span> <span class="p">[</span><span class="n">arg</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
                           <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">otherlist</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">to</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">m</span><span class="p">)]</span>
                <span class="n">cond</span> <span class="o">=</span> <span class="n">cond</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">newargs</span><span class="p">)</span>
                <span class="n">change</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
    <span class="c1"># final tweak</span>

    <span class="k">def</span> <span class="nf">repl_eq</span><span class="p">(</span><span class="n">orig</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">orig</span><span class="o">.</span><span class="n">lhs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">orig</span><span class="o">.</span><span class="n">rhs</span>
        <span class="k">elif</span> <span class="n">orig</span><span class="o">.</span><span class="n">rhs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">orig</span><span class="o">.</span><span class="n">lhs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">orig</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">unbranched_argument</span><span class="p">(</span><span class="n">polar_lift</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="n">q</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">func</span> <span class="ow">is</span> <span class="n">periodic_argument</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_polar</span> \
                    <span class="ow">and</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">oo</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">orig</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cond</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">expr</span><span class="p">:</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_Relational</span> <span class="ow">and</span> <span class="n">expr</span><span class="o">.</span><span class="n">rel_op</span> <span class="o">==</span> <span class="s1">&#39;==&#39;</span><span class="p">,</span>
        <span class="n">repl_eq</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_eval_cond</span><span class="p">(</span><span class="n">cond</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Re-evaluate the conditions. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cond</span>
    <span class="k">return</span> <span class="n">_condsimp</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">doit</span><span class="p">())</span>

<span class="c1">####################################################################</span>
<span class="c1"># Now the &quot;backbone&quot; functions to do actual integration.</span>
<span class="c1">####################################################################</span>


<span class="k">def</span> <span class="nf">_my_principal_branch</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">full_pb</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Bring expr nearer to its principal branch by removing superfluous</span>
<span class="sd">        factors.</span>
<span class="sd">        This function does *not* guarantee to yield the principal branch,</span>
<span class="sd">        to avoid introducing opaque principal_branch() objects,</span>
<span class="sd">        unless full_pb=True. &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">principal_branch</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">principal_branch</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">period</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">full_pb</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">principal_branch</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>


<span class="k">def</span> <span class="nf">_rewrite_saxena_1</span><span class="p">(</span><span class="n">fac</span><span class="p">,</span> <span class="n">po</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rewrite the integral fac*po*g dx, from zero to infinity, as</span>
<span class="sd">    integral fac*G, where G has argument a*x. Note po=x**s.</span>
<span class="sd">    Return fac, G.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">po</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">argument</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">period</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">get_period</span><span class="p">()</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">_my_principal_branch</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">period</span><span class="p">)</span>

    <span class="c1"># We substitute t = x**b.</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">fac</span><span class="o">/</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="o">**</span><span class="p">((</span><span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="c1"># Absorb a factor of (at)**((1 + s)/b - 1).</span>

    <span class="k">def</span> <span class="nf">tr</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">a</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span><span class="o">/</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">C</span><span class="p">,</span> <span class="n">meijerg</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">an</span><span class="p">),</span> <span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">aother</span><span class="p">),</span> <span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">bm</span><span class="p">),</span> <span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">bother</span><span class="p">),</span>
                      <span class="n">a</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_check_antecedents_1</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">helper</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a condition under which the mellin transform of g exists.</span>
<span class="sd">    Any power of x has already been absorbed into the G function,</span>
<span class="sd">    so this is just int_0^\infty g dx.</span>

<span class="sd">    See [L, section 5.6.1]. (Note that s=1.)</span>

<span class="sd">    If ``helper`` is True, only check if the MT exists at infinity, i.e. if</span>
<span class="sd">    int_1^\infty g dx exists.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># NOTE if you update these conditions, please update the documentation as well</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">Eq</span><span class="p">,</span> <span class="n">Not</span><span class="p">,</span> <span class="n">ceiling</span><span class="p">,</span> <span class="n">Ne</span><span class="p">,</span> <span class="n">re</span><span class="p">,</span> <span class="n">unbranched_argument</span> <span class="k">as</span> <span class="n">arg</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">delta</span>
    <span class="n">eta</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">argument</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">S</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">bm</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">an</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ap</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">bq</span><span class="p">)])</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="n">p</span>

    <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">tr</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">_check_antecedents_1</span><span class="p">(</span><span class="n">meijerg</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">bm</span><span class="p">),</span> <span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">bother</span><span class="p">),</span>
                                            <span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">an</span><span class="p">),</span> <span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">aother</span><span class="p">),</span> <span class="n">x</span><span class="o">/</span><span class="n">eta</span><span class="p">),</span>
                                    <span class="n">x</span><span class="p">)</span>

    <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">bm</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">+=</span> <span class="p">[</span><span class="o">-</span><span class="n">re</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">an</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">re</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span>
    <span class="n">cond_3</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="o">*</span><span class="n">tmp</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">bother</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">+=</span> <span class="p">[</span><span class="o">-</span><span class="n">re</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">aother</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">re</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span>
    <span class="n">cond_3_star</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="o">*</span><span class="n">tmp</span><span class="p">)</span>

    <span class="n">cond_4</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">re</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">nu</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">q</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="n">q</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="o">*</span><span class="n">msg</span><span class="p">):</span>
        <span class="n">_debug</span><span class="p">(</span><span class="o">*</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Checking antecedents for 1 function:&#39;</span><span class="p">)</span>
    <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;  delta=</span><span class="si">%s</span><span class="s1">, eta=</span><span class="si">%s</span><span class="s1">, m=</span><span class="si">%s</span><span class="s1">, n=</span><span class="si">%s</span><span class="s1">, p=</span><span class="si">%s</span><span class="s1">, q=</span><span class="si">%s</span><span class="s1">&#39;</span>
          <span class="o">%</span> <span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>
    <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;  ap = </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">an</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">aother</span><span class="p">)))</span>
    <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;  bq = </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">bm</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">bother</span><span class="p">)))</span>
    <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;  cond_3=</span><span class="si">%s</span><span class="s1">, cond_3*=</span><span class="si">%s</span><span class="s1">, cond_4=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cond_3</span><span class="p">,</span> <span class="n">cond_3_star</span><span class="p">,</span> <span class="n">cond_4</span><span class="p">))</span>

    <span class="n">conds</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># case 1</span>
    <span class="n">case1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tmp1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">]</span>
    <span class="n">tmp2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">,</span> <span class="n">Eq</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">Not</span><span class="p">(</span><span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))]</span>
    <span class="n">tmp3</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="p">,</span> <span class="n">Eq</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ceiling</span><span class="p">(</span><span class="n">delta</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">tmp3</span> <span class="o">+=</span> <span class="p">[</span><span class="n">Ne</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">eta</span><span class="p">)),</span> <span class="p">(</span><span class="n">delta</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span><span class="p">)]</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">eta</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">delta</span><span class="o">*</span><span class="n">pi</span><span class="p">]</span>
    <span class="n">extra</span> <span class="o">=</span> <span class="p">[</span><span class="n">Ne</span><span class="p">(</span><span class="n">eta</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">cond_3</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">helper</span><span class="p">:</span>
        <span class="n">extra</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="n">tmp1</span><span class="p">,</span> <span class="n">tmp2</span><span class="p">,</span> <span class="n">tmp3</span><span class="p">]:</span>
        <span class="n">case1</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">tmp</span> <span class="o">+</span> <span class="n">extra</span><span class="p">))]</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="n">case1</span>
    <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;  case 1:&#39;</span><span class="p">,</span> <span class="n">case1</span><span class="p">)</span>

    <span class="c1"># case 2</span>
    <span class="n">extra</span> <span class="o">=</span> <span class="p">[</span><span class="n">cond_3</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">helper</span><span class="p">:</span>
        <span class="n">extra</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">case2</span> <span class="o">=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">,</span> <span class="n">m</span> <span class="o">&lt;=</span> <span class="n">q</span><span class="p">,</span>
                 <span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">eta</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">delta</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">)]</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="n">case2</span>
    <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;  case 2:&#39;</span><span class="p">,</span> <span class="n">case2</span><span class="p">)</span>

    <span class="c1"># case 3</span>
    <span class="n">extra</span> <span class="o">=</span> <span class="p">[</span><span class="n">cond_3</span><span class="p">,</span> <span class="n">cond_4</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">helper</span><span class="p">:</span>
        <span class="n">extra</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">case3</span> <span class="o">=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">,</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Eq</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">eta</span><span class="p">)),</span> <span class="n">delta</span><span class="o">*</span><span class="n">pi</span><span class="p">),</span>
                 <span class="o">*</span><span class="n">extra</span><span class="p">)]</span>
    <span class="n">case3</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">p</span> <span class="o">&lt;=</span> <span class="n">q</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Eq</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">eta</span><span class="p">)),</span> <span class="mi">0</span><span class="p">),</span> <span class="o">*</span><span class="n">extra</span><span class="p">)]</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="n">case3</span>
    <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;  case 3:&#39;</span><span class="p">,</span> <span class="n">case3</span><span class="p">)</span>

    <span class="c1"># TODO altered cases 4-7</span>

    <span class="c1"># extra case from wofram functions site:</span>
    <span class="c1"># (reproduced verbatim from Prudnikov, section 2.24.2)</span>
    <span class="c1"># http://functions.wolfram.com/HypergeometricFunctions/MeijerG/21/02/01/</span>
    <span class="n">case_extra</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">case_extra</span> <span class="o">+=</span> <span class="p">[</span><span class="n">Eq</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">eta</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Ne</span><span class="p">(</span><span class="n">eta</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">helper</span><span class="p">:</span>
        <span class="n">case_extra</span> <span class="o">+=</span> <span class="p">[</span><span class="n">cond_3</span><span class="p">]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ap</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">bq</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="p">[</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">]</span>
    <span class="n">case_extra</span> <span class="o">+=</span> <span class="p">[</span><span class="n">re</span><span class="p">(</span><span class="n">Add</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">case_extra</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="o">*</span><span class="n">case_extra</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">case_extra</span><span class="p">]</span>
    <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;  extra case:&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">case_extra</span><span class="p">])</span>

    <span class="n">case_extra_2</span> <span class="o">=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">eta</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">delta</span><span class="o">*</span><span class="n">pi</span><span class="p">)]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">helper</span><span class="p">:</span>
        <span class="n">case_extra_2</span> <span class="o">+=</span> <span class="p">[</span><span class="n">cond_3</span><span class="p">]</span>
    <span class="n">case_extra_2</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="o">*</span><span class="n">case_extra_2</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">case_extra_2</span><span class="p">]</span>
    <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;  second extra case:&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">case_extra_2</span><span class="p">])</span>

    <span class="c1"># TODO This leaves only one case from the three listed by Prudnikov.</span>
    <span class="c1">#      Investigate if these indeed cover everything; if so, remove the rest.</span>

    <span class="k">return</span> <span class="n">Or</span><span class="p">(</span><span class="o">*</span><span class="n">conds</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_int0oo_1</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate int_0^\infty g dx using G functions,</span>
<span class="sd">    assuming the necessary conditions are fulfilled.</span>

<span class="sd">    &gt;&gt;&gt; from ..abc import a, b, c, d, x, y</span>
<span class="sd">    &gt;&gt;&gt; from .. import meijerg</span>
<span class="sd">    &gt;&gt;&gt; from .meijerint import _int0oo_1</span>
<span class="sd">    &gt;&gt;&gt; _int0oo_1(meijerg([a], [b], [c], [d], x*y), x)</span>
<span class="sd">    gamma(-a)*gamma(c + 1)/(y*gamma(-d)*gamma(b + 1))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># See [L, section 5.6.1]. Note that s=1.</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">combsimp</span><span class="p">,</span> <span class="n">unpolarify</span>
    <span class="n">eta</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">argument</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">eta</span>
    <span class="c1"># XXX TODO we should reduce order first</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">bm</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">*=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">an</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">*=</span> <span class="n">gamma</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">bother</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">/=</span> <span class="n">gamma</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">aother</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">/=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">combsimp</span><span class="p">(</span><span class="n">unpolarify</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_rewrite_saxena</span><span class="p">(</span><span class="n">fac</span><span class="p">,</span> <span class="n">po</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">full_pb</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rewrite the integral fac*po*g1*g2 from 0 to oo in terms of G functions</span>
<span class="sd">    with argument c*x.</span>
<span class="sd">    Return C, f1, f2 such that integral C f1 f2 from 0 to infinity equals</span>
<span class="sd">    integral fac po g1 g2 from 0 to infinity.</span>

<span class="sd">    &gt;&gt;&gt; from .meijerint import _rewrite_saxena</span>
<span class="sd">    &gt;&gt;&gt; from ..abc import s, t, m</span>
<span class="sd">    &gt;&gt;&gt; from .. import meijerg</span>
<span class="sd">    &gt;&gt;&gt; g1 = meijerg([], [], [0], [], s*t)</span>
<span class="sd">    &gt;&gt;&gt; g2 = meijerg([], [], [m/2], [-m/2], t**2/4)</span>
<span class="sd">    &gt;&gt;&gt; r = _rewrite_saxena(1, t**0, g1, g2, t)</span>
<span class="sd">    &gt;&gt;&gt; r[0]</span>
<span class="sd">    s/(4*sqrt(pi))</span>
<span class="sd">    &gt;&gt;&gt; r[1]</span>
<span class="sd">    meijerg(((), ()), ((-1/2, 0), ()), s**2*t/4)</span>
<span class="sd">    &gt;&gt;&gt; r[2]</span>
<span class="sd">    meijerg(((), ()), ((m/2,), (-m/2,)), t/4)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">..core.numbers</span> <span class="kn">import</span> <span class="n">ilcm</span>

    <span class="k">def</span> <span class="nf">pb</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">argument</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">per</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">get_period</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">meijerg</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">an</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">aother</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">bm</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">bother</span><span class="p">,</span>
                       <span class="n">_my_principal_branch</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">per</span><span class="p">,</span> <span class="n">full_pb</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="n">b</span><span class="p">)</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">po</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">g1</span><span class="o">.</span><span class="n">argument</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">g2</span><span class="o">.</span><span class="n">argument</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">b1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">b1</span> <span class="o">=</span> <span class="o">-</span><span class="n">b1</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">_flip_g</span><span class="p">(</span><span class="n">g1</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">b2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">b2</span> <span class="o">=</span> <span class="o">-</span><span class="n">b2</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">_flip_g</span><span class="p">(</span><span class="n">g2</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">b1</span><span class="o">.</span><span class="n">is_Rational</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">b2</span><span class="o">.</span><span class="n">is_Rational</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">m1</span><span class="p">,</span> <span class="n">n1</span> <span class="o">=</span> <span class="n">b1</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">b1</span><span class="o">.</span><span class="n">q</span>
    <span class="n">m2</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">b2</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">b2</span><span class="o">.</span><span class="n">q</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">ilcm</span><span class="p">(</span><span class="n">m1</span><span class="o">*</span><span class="n">n2</span><span class="p">,</span> <span class="n">m2</span><span class="o">*</span><span class="n">n1</span><span class="p">)</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">tau</span><span class="o">//</span><span class="p">(</span><span class="n">m1</span><span class="o">*</span><span class="n">n2</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">tau</span><span class="o">//</span><span class="p">(</span><span class="n">m2</span><span class="o">*</span><span class="n">n1</span><span class="p">)</span>

    <span class="n">C1</span><span class="p">,</span> <span class="n">g1</span> <span class="o">=</span> <span class="n">_inflate_g</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="n">r1</span><span class="p">)</span>
    <span class="n">C2</span><span class="p">,</span> <span class="n">g2</span> <span class="o">=</span> <span class="n">_inflate_g</span><span class="p">(</span><span class="n">g2</span><span class="p">,</span> <span class="n">r2</span><span class="p">)</span>
    <span class="n">g1</span> <span class="o">=</span> <span class="n">pb</span><span class="p">(</span><span class="n">g1</span><span class="p">)</span>
    <span class="n">g2</span> <span class="o">=</span> <span class="n">pb</span><span class="p">(</span><span class="n">g2</span><span class="p">)</span>

    <span class="n">fac</span> <span class="o">*=</span> <span class="n">C1</span><span class="o">*</span><span class="n">C2</span>
    <span class="n">a1</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">g1</span><span class="o">.</span><span class="n">argument</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">a2</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">g2</span><span class="o">.</span><span class="n">argument</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="c1"># arbitrarily tack on the x**s part to g1</span>
    <span class="c1"># TODO should we try both?</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">fac</span> <span class="o">=</span> <span class="n">fac</span><span class="o">/</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">a1</span><span class="o">**</span><span class="n">exp</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tr</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">a</span> <span class="o">+</span> <span class="n">exp</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span>
    <span class="n">g1</span> <span class="o">=</span> <span class="n">meijerg</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="n">g1</span><span class="o">.</span><span class="n">an</span><span class="p">),</span> <span class="n">tr</span><span class="p">(</span><span class="n">g1</span><span class="o">.</span><span class="n">aother</span><span class="p">),</span> <span class="n">tr</span><span class="p">(</span><span class="n">g1</span><span class="o">.</span><span class="n">bm</span><span class="p">),</span> <span class="n">tr</span><span class="p">(</span><span class="n">g1</span><span class="o">.</span><span class="n">bother</span><span class="p">),</span> <span class="n">a1</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
    <span class="n">g2</span> <span class="o">=</span> <span class="n">meijerg</span><span class="p">(</span><span class="n">g2</span><span class="o">.</span><span class="n">an</span><span class="p">,</span> <span class="n">g2</span><span class="o">.</span><span class="n">aother</span><span class="p">,</span> <span class="n">g2</span><span class="o">.</span><span class="n">bm</span><span class="p">,</span> <span class="n">g2</span><span class="o">.</span><span class="n">bother</span><span class="p">,</span> <span class="n">a2</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">powdenest</span><span class="p">(</span><span class="n">fac</span><span class="p">,</span> <span class="n">polar</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>


<span class="k">def</span> <span class="nf">_check_antecedents</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Return a condition under which the integral theorem applies. &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">re</span><span class="p">,</span> <span class="n">Eq</span><span class="p">,</span> <span class="n">Ne</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">sign</span><span class="p">,</span> <span class="n">unpolarify</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">arg</span> <span class="k">as</span> <span class="n">arg_</span><span class="p">,</span> <span class="n">unbranched_argument</span> <span class="k">as</span> <span class="n">arg</span>
    <span class="c1">#  Yes, this is madness.</span>
    <span class="c1"># XXX TODO this is a testing *nightmare*</span>
    <span class="c1"># NOTE if you update these conditions, please update the documentation as well</span>

    <span class="c1"># The following conditions are found in</span>
    <span class="c1"># [P], Section 2.24.1</span>
    <span class="c1">#</span>
    <span class="c1"># They are also reproduced (verbatim!) at</span>
    <span class="c1"># http://functions.wolfram.com/HypergeometricFunctions/MeijerG/21/02/03/</span>
    <span class="c1">#</span>
    <span class="c1"># Note: k=l=r=alpha=1</span>
    <span class="n">sigma</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">g1</span><span class="o">.</span><span class="n">argument</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">omega</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">g2</span><span class="o">.</span><span class="n">argument</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">S</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">g1</span><span class="o">.</span><span class="n">bm</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">g1</span><span class="o">.</span><span class="n">an</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">g1</span><span class="o">.</span><span class="n">ap</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">g1</span><span class="o">.</span><span class="n">bq</span><span class="p">)])</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">S</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">g2</span><span class="o">.</span><span class="n">bm</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">g2</span><span class="o">.</span><span class="n">an</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">g2</span><span class="o">.</span><span class="n">ap</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">g2</span><span class="o">.</span><span class="n">bq</span><span class="p">)])</span>
    <span class="n">bstar</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">t</span> <span class="o">-</span> <span class="p">(</span><span class="n">u</span> <span class="o">+</span> <span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">cstar</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">g1</span><span class="o">.</span><span class="n">nu</span> <span class="o">+</span> <span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">g2</span><span class="o">.</span><span class="n">nu</span> <span class="o">+</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">q</span> <span class="o">-</span> <span class="n">p</span> <span class="o">-</span> <span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span> <span class="o">-</span> <span class="n">mu</span> <span class="o">-</span> <span class="n">rho</span>
    <span class="n">psi</span> <span class="o">=</span> <span class="p">(</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="n">m</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">omega</span><span class="p">)))</span><span class="o">/</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="p">(</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">s</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">sigma</span><span class="p">)))</span><span class="o">/</span><span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span>

    <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Checking antecedents:&#39;</span><span class="p">)</span>
    <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;  sigma=</span><span class="si">%s</span><span class="s1">, s=</span><span class="si">%s</span><span class="s1">, t=</span><span class="si">%s</span><span class="s1">, u=</span><span class="si">%s</span><span class="s1">, v=</span><span class="si">%s</span><span class="s1">, b*=</span><span class="si">%s</span><span class="s1">, rho=</span><span class="si">%s</span><span class="s1">&#39;</span>
           <span class="o">%</span> <span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">bstar</span><span class="p">,</span> <span class="n">rho</span><span class="p">))</span>
    <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;  omega=</span><span class="si">%s</span><span class="s1">, m=</span><span class="si">%s</span><span class="s1">, n=</span><span class="si">%s</span><span class="s1">, p=</span><span class="si">%s</span><span class="s1">, q=</span><span class="si">%s</span><span class="s1">, c*=</span><span class="si">%s</span><span class="s1">, mu=</span><span class="si">%s</span><span class="s1">,&#39;</span>
           <span class="o">%</span> <span class="p">(</span><span class="n">omega</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">cstar</span><span class="p">,</span> <span class="n">mu</span><span class="p">))</span>
    <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;  phi=</span><span class="si">%s</span><span class="s1">, eta=</span><span class="si">%s</span><span class="s1">, psi=</span><span class="si">%s</span><span class="s1">, theta=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">theta</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_c1</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">[</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">an</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">bm</span><span class="p">:</span>
                    <span class="n">diff</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span>
                    <span class="k">if</span> <span class="n">diff</span><span class="o">.</span><span class="n">is_integer</span> <span class="ow">and</span> <span class="n">diff</span><span class="o">.</span><span class="n">is_positive</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="n">_c1</span><span class="p">()</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">re</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">g1</span><span class="o">.</span><span class="n">bm</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">g2</span><span class="o">.</span><span class="n">bm</span><span class="p">])</span>
    <span class="n">c3</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">re</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">g1</span><span class="o">.</span><span class="n">an</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">g2</span><span class="o">.</span><span class="n">an</span><span class="p">])</span>
    <span class="n">c4</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="o">*</span><span class="p">[(</span><span class="n">p</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="n">re</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">re</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">g1</span><span class="o">.</span><span class="n">an</span><span class="p">])</span>
    <span class="n">c5</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="o">*</span><span class="p">[(</span><span class="n">p</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="n">re</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">re</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">g1</span><span class="o">.</span><span class="n">bm</span><span class="p">])</span>
    <span class="n">c6</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="o">*</span><span class="p">[(</span><span class="n">u</span> <span class="o">-</span> <span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="n">re</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">re</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">g2</span><span class="o">.</span><span class="n">an</span><span class="p">])</span>
    <span class="n">c7</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="o">*</span><span class="p">[(</span><span class="n">u</span> <span class="o">-</span> <span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="n">re</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">re</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">S</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">g2</span><span class="o">.</span><span class="n">bm</span><span class="p">])</span>
    <span class="n">c8</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">re</span><span class="p">((</span><span class="n">rho</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">mu</span> <span class="o">-</span>
          <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">u</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">c9</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">re</span><span class="p">((</span><span class="n">rho</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">mu</span> <span class="o">-</span>
          <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">u</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">c10</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">bstar</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">c11</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">sigma</span><span class="p">)),</span> <span class="n">bstar</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">c12</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">omega</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">cstar</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">c13</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">omega</span><span class="p">)),</span> <span class="n">cstar</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span>

    <span class="c1"># The following condition is *not* implemented as stated on the wolfram</span>
    <span class="c1"># function site. In the book of Prudnikov there is an additional part</span>
    <span class="c1"># (the And involving re()). However, I only have this book in russian, and</span>
    <span class="c1"># I don&#39;t read any russian. The following condition is what other people</span>
    <span class="c1"># have told me it means.</span>
    <span class="c1"># Worryingly, it is different from the condition implemented in REDUCE.</span>
    <span class="c1"># The REDUCE implementation:</span>
    <span class="c1">#   https://reduce-algebra.svn.sourceforge.net/svnroot/reduce-algebra/trunk/packages/defint/definta.red</span>
    <span class="c1">#   (search for tst14)</span>
    <span class="c1"># The Wolfram alpha version:</span>
    <span class="c1">#   http://functions.wolfram.com/HypergeometricFunctions/MeijerG/21/02/03/03/0014/</span>
    <span class="n">z0</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">bstar</span> <span class="o">+</span> <span class="n">cstar</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">I</span><span class="p">)</span>
    <span class="n">zos</span> <span class="o">=</span> <span class="n">unpolarify</span><span class="p">(</span><span class="n">z0</span><span class="o">*</span><span class="n">omega</span><span class="o">/</span><span class="n">sigma</span><span class="p">)</span>
    <span class="n">zso</span> <span class="o">=</span> <span class="n">unpolarify</span><span class="p">(</span><span class="n">z0</span><span class="o">*</span><span class="n">sigma</span><span class="o">/</span><span class="n">omega</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">zos</span> <span class="o">==</span> <span class="mi">1</span><span class="o">/</span><span class="n">zso</span><span class="p">:</span>
        <span class="n">c14</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">bstar</span> <span class="o">+</span> <span class="n">cstar</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span>
                  <span class="n">Or</span><span class="p">(</span><span class="n">Ne</span><span class="p">(</span><span class="n">zos</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">re</span><span class="p">(</span><span class="n">mu</span> <span class="o">+</span> <span class="n">rho</span> <span class="o">+</span> <span class="n">v</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="n">re</span><span class="p">(</span><span class="n">mu</span> <span class="o">+</span> <span class="n">rho</span> <span class="o">+</span> <span class="n">q</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">c14</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">bstar</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">cstar</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="n">Or</span><span class="p">(</span><span class="n">And</span><span class="p">(</span><span class="n">Ne</span><span class="p">(</span><span class="n">zos</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">arg_</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">zos</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">pi</span><span class="p">),</span>
                     <span class="n">And</span><span class="p">(</span><span class="n">re</span><span class="p">(</span><span class="n">mu</span> <span class="o">+</span> <span class="n">rho</span> <span class="o">+</span> <span class="n">v</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Eq</span><span class="p">(</span><span class="n">zos</span><span class="p">,</span> <span class="mi">1</span><span class="p">))))</span>

        <span class="k">def</span> <span class="nf">_cond</span><span class="p">():</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Note: if `zso` is 1 then tmp will be NaN.  This raises a</span>
<span class="sd">            TypeError on `NaN &lt; pi`.  Previously this gave `False` so</span>
<span class="sd">            this behavior has been hardcoded here but someone should</span>
<span class="sd">            check if this NaN is more serious! This NaN is triggered by</span>
<span class="sd">            test_meijerint() in test_meijerint.py:</span>
<span class="sd">            `meijerint_definite(exp(x), x, 0, I)`</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">arg_</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">zso</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">tmp</span> <span class="ow">is</span> <span class="n">S</span><span class="o">.</span><span class="n">NaN</span> <span class="k">else</span> <span class="n">tmp</span> <span class="o">&lt;</span> <span class="n">pi</span>
        <span class="n">c14_alt</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">cstar</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">bstar</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="n">Or</span><span class="p">(</span><span class="n">And</span><span class="p">(</span><span class="n">Ne</span><span class="p">(</span><span class="n">zso</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">_cond</span><span class="p">()),</span>
                     <span class="n">And</span><span class="p">(</span><span class="n">re</span><span class="p">(</span><span class="n">mu</span> <span class="o">+</span> <span class="n">rho</span> <span class="o">+</span> <span class="n">q</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Eq</span><span class="p">(</span><span class="n">zso</span><span class="p">,</span> <span class="mi">1</span><span class="p">))))</span>

        <span class="c1"># Since r=k=l=1, in our case there is c14_alt which is the same as calling</span>
        <span class="c1"># us with (g1, g2) = (g2, g1). The conditions below enumerate all cases</span>
        <span class="c1"># (i.e. we don&#39;t have to try arguments reversed by hand), and indeed try</span>
        <span class="c1"># all symmetric cases. (i.e. whenever there is a condition involving c14,</span>
        <span class="c1"># there is also a dual condition which is exactly what we would get when g1,</span>
        <span class="c1"># g2 were interchanged, *but c14 was unaltered*).</span>
        <span class="c1"># Hence the following seems correct:</span>
        <span class="n">c14</span> <span class="o">=</span> <span class="n">Or</span><span class="p">(</span><span class="n">c14</span><span class="p">,</span> <span class="n">c14_alt</span><span class="p">)</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    When `c15` is NaN (e.g. from `psi` being NaN as happens during</span>
<span class="sd">    &#39;test_issue_4992&#39; and/or `theta` is NaN as in &#39;test_issue_6253&#39;,</span>
<span class="sd">    both in `test_integrals.py`) the comparison to 0 formerly gave False</span>
<span class="sd">    whereas now an error is raised. To keep the old behavior, the value</span>
<span class="sd">    of NaN is replaced with False but perhaps a closer look at this condition</span>
<span class="sd">    should be made: XXX how should conditions leading to c15=NaN be handled?</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">lambda_c</span> <span class="o">=</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">omega</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="n">p</span><span class="p">))</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span> \
            <span class="o">+</span> <span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">u</span><span class="p">))</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="c1"># the TypeError might be raised here, e.g. if lambda_c is NaN</span>
        <span class="k">if</span> <span class="n">_eval_cond</span><span class="p">(</span><span class="n">lambda_c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">c15</span> <span class="o">=</span> <span class="p">(</span><span class="n">lambda_c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">lambda_s0</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">c1</span><span class="o">*</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">omega</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="n">p</span><span class="p">))</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span> \
                    <span class="o">+</span> <span class="n">c2</span><span class="o">*</span><span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">u</span><span class="p">))</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">lambda_s</span> <span class="o">=</span> <span class="n">Piecewise</span><span class="p">(</span>
                <span class="p">((</span><span class="n">lambda_s0</span><span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">lambda_s0</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)),</span>
                 <span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">sigma</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">omega</span><span class="p">),</span> <span class="mi">0</span><span class="p">))),</span>
                <span class="p">(</span><span class="n">lambda_s0</span><span class="p">(</span><span class="n">sign</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">omega</span><span class="p">)),</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">lambda_s0</span><span class="p">(</span><span class="n">sign</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">omega</span><span class="p">)),</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                 <span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">sigma</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Ne</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">omega</span><span class="p">),</span> <span class="mi">0</span><span class="p">))),</span>
                <span class="p">(</span><span class="n">lambda_s0</span><span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">sign</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">sigma</span><span class="p">)))</span><span class="o">*</span><span class="n">lambda_s0</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">sign</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">sigma</span><span class="p">))),</span>
                 <span class="n">And</span><span class="p">(</span><span class="n">Ne</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">sigma</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">omega</span><span class="p">),</span> <span class="mi">0</span><span class="p">))),</span>
                <span class="p">(</span><span class="n">lambda_s0</span><span class="p">(</span><span class="n">sign</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">omega</span><span class="p">)),</span> <span class="n">sign</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">sigma</span><span class="p">))),</span> <span class="kc">True</span><span class="p">))</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">lambda_c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                   <span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">lambda_c</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Ne</span><span class="p">(</span><span class="n">lambda_s</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">re</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                   <span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">lambda_c</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">lambda_s</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">re</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>
            <span class="n">c15</span> <span class="o">=</span> <span class="n">Or</span><span class="p">(</span><span class="o">*</span><span class="n">tmp</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">c15</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">cond</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">c1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">c3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="n">c4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="n">c5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="n">c6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">c7</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="n">c8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="n">c9</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="p">(</span><span class="n">c10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="n">c11</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">c12</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="n">c13</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="p">(</span><span class="n">c14</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span> <span class="p">(</span><span class="n">c15</span><span class="p">,</span> <span class="mi">15</span><span class="p">)]:</span>
        <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;  c</span><span class="si">%s</span><span class="s1">:&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="n">cond</span><span class="p">)</span>

    <span class="c1"># We will return Or(*conds)</span>
    <span class="n">conds</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">pr</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
        <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;  case </span><span class="si">%s</span><span class="s1">:&#39;</span> <span class="o">%</span> <span class="n">count</span><span class="p">,</span> <span class="n">conds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">s</span><span class="o">*</span><span class="n">t</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c10</span><span class="p">,</span>
                  <span class="n">c12</span><span class="p">)]</span>  <span class="c1"># 1</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">bstar</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">cstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">sigma</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">re</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span>
                  <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c12</span><span class="p">)]</span>  <span class="c1"># 2</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">cstar</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">bstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">omega</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">re</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span>
                  <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c10</span><span class="p">)]</span>  <span class="c1"># 3</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">bstar</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">cstar</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                  <span class="n">sigma</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">omega</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">re</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">re</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span>
                  <span class="n">Ne</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">omega</span><span class="p">),</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">)]</span>  <span class="c1"># 4</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">bstar</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">cstar</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                  <span class="n">sigma</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">omega</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">re</span><span class="p">(</span><span class="n">mu</span> <span class="o">+</span> <span class="n">rho</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span>
                  <span class="n">Ne</span><span class="p">(</span><span class="n">omega</span><span class="p">,</span> <span class="n">sigma</span><span class="p">),</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">)]</span>  <span class="c1"># 5</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">p</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c5</span><span class="p">,</span> <span class="n">c10</span><span class="p">,</span> <span class="n">c13</span><span class="p">)]</span>  <span class="c1"># 6</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c4</span><span class="p">,</span> <span class="n">c10</span><span class="p">,</span> <span class="n">c13</span><span class="p">)]</span>  <span class="c1"># 7</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">u</span> <span class="o">&gt;</span> <span class="n">v</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c7</span><span class="p">,</span> <span class="n">c11</span><span class="p">,</span> <span class="n">c12</span><span class="p">)]</span>  <span class="c1"># 8</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">u</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c6</span><span class="p">,</span> <span class="n">c11</span><span class="p">,</span> <span class="n">c12</span><span class="p">)]</span>  <span class="c1"># 9</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">p</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">,</span> <span class="n">Eq</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">bstar</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">cstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="n">re</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c5</span><span class="p">,</span> <span class="n">c13</span><span class="p">)]</span>  <span class="c1"># 10</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">,</span> <span class="n">Eq</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">bstar</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">cstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="n">re</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c4</span><span class="p">,</span> <span class="n">c13</span><span class="p">)]</span>  <span class="c1"># 11</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">u</span> <span class="o">&gt;</span> <span class="n">v</span><span class="p">,</span> <span class="n">bstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Eq</span><span class="p">(</span><span class="n">cstar</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">omega</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="n">re</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c7</span><span class="p">,</span> <span class="n">c11</span><span class="p">)]</span>  <span class="c1"># 12</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">u</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">,</span> <span class="n">bstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Eq</span><span class="p">(</span><span class="n">cstar</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">omega</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="n">re</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c6</span><span class="p">,</span> <span class="n">c11</span><span class="p">)]</span>  <span class="c1"># 13</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">,</span> <span class="n">u</span> <span class="o">&gt;</span> <span class="n">v</span><span class="p">,</span> <span class="n">bstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c4</span><span class="p">,</span> <span class="n">c7</span><span class="p">,</span> <span class="n">c11</span><span class="p">,</span> <span class="n">c13</span><span class="p">)]</span>  <span class="c1"># 14</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">p</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">,</span> <span class="n">u</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">,</span> <span class="n">bstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c5</span><span class="p">,</span> <span class="n">c6</span><span class="p">,</span> <span class="n">c11</span><span class="p">,</span> <span class="n">c13</span><span class="p">)]</span>  <span class="c1"># 15</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">p</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">,</span> <span class="n">u</span> <span class="o">&gt;</span> <span class="n">v</span><span class="p">,</span> <span class="n">bstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c5</span><span class="p">,</span> <span class="n">c7</span><span class="p">,</span> <span class="n">c8</span><span class="p">,</span> <span class="n">c11</span><span class="p">,</span> <span class="n">c13</span><span class="p">,</span> <span class="n">c14</span><span class="p">)]</span>  <span class="c1"># 16</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">,</span> <span class="n">u</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">,</span> <span class="n">bstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c4</span><span class="p">,</span> <span class="n">c6</span><span class="p">,</span> <span class="n">c9</span><span class="p">,</span> <span class="n">c11</span><span class="p">,</span> <span class="n">c13</span><span class="p">,</span> <span class="n">c14</span><span class="p">)]</span>  <span class="c1"># 17</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">s</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">phi</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c10</span><span class="p">)]</span>  <span class="c1"># 18</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">t</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">phi</span><span class="o">.</span><span class="n">is_negative</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c10</span><span class="p">)]</span>  <span class="c1"># 19</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">m</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">phi</span><span class="o">.</span><span class="n">is_negative</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c12</span><span class="p">)]</span>  <span class="c1"># 20</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">n</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">phi</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c12</span><span class="p">)]</span>  <span class="c1"># 21</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">bstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c10</span><span class="p">,</span> <span class="n">c12</span><span class="p">)]</span>  <span class="c1"># 22</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">bstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c10</span><span class="p">,</span> <span class="n">c12</span><span class="p">)]</span>  <span class="c1"># 23</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span>

    <span class="c1"># The following case is from [Luke1969]. As far as I can tell, it is *not*</span>
    <span class="c1"># covered by Prudnikov&#39;s.</span>
    <span class="c1"># Let G1 and G2 be the two G-functions. Suppose the integral exists from</span>
    <span class="c1"># 0 to a &gt; 0 (this is easy the easy part), that G1 is exponential decay at</span>
    <span class="c1"># infinity, and that the mellin transform of G2 exists.</span>
    <span class="c1"># Then the integral exists.</span>
    <span class="n">mt1_exists</span> <span class="o">=</span> <span class="n">_check_antecedents_1</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">helper</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">mt2_exists</span> <span class="o">=</span> <span class="n">_check_antecedents_1</span><span class="p">(</span><span class="n">g2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">helper</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">mt2_exists</span><span class="p">,</span> <span class="n">Eq</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">u</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">,</span> <span class="n">bstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">c10</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">)]</span>
    <span class="n">pr</span><span class="p">(</span><span class="s1">&#39;E1&#39;</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">mt2_exists</span><span class="p">,</span> <span class="n">Eq</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="n">t</span><span class="p">,</span> <span class="n">bstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">c10</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">)]</span>
    <span class="n">pr</span><span class="p">(</span><span class="s1">&#39;E2&#39;</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">mt1_exists</span><span class="p">,</span> <span class="n">Eq</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">,</span> <span class="n">cstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">c12</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">)]</span>
    <span class="n">pr</span><span class="p">(</span><span class="s1">&#39;E3&#39;</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">mt1_exists</span><span class="p">,</span> <span class="n">Eq</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">q</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">,</span> <span class="n">cstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">c12</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">)]</span>
    <span class="n">pr</span><span class="p">(</span><span class="s1">&#39;E4&#39;</span><span class="p">)</span>

    <span class="c1"># Let&#39;s short-circuit if this worked ...</span>
    <span class="c1"># the rest is corner-cases and terrible to read.</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">Or</span><span class="p">(</span><span class="o">*</span><span class="n">conds</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_eval_cond</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">r</span>

    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">p</span><span class="p">,</span> <span class="n">Eq</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">s</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cstar</span><span class="o">.</span><span class="n">is_negative</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">omega</span><span class="p">))</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span>
                  <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c10</span><span class="p">,</span> <span class="n">c14</span><span class="p">,</span> <span class="n">c15</span><span class="p">)]</span>  <span class="c1"># 24</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">q</span><span class="p">,</span> <span class="n">Eq</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">t</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cstar</span><span class="o">.</span><span class="n">is_negative</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">omega</span><span class="p">))</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span>
                  <span class="n">c1</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c10</span><span class="p">,</span> <span class="n">c14</span><span class="p">,</span> <span class="n">c15</span><span class="p">)]</span>  <span class="c1"># 25</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">s</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="n">cstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cstar</span><span class="o">*</span><span class="n">pi</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">omega</span><span class="p">)),</span>
                  <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c10</span><span class="p">,</span> <span class="n">c14</span><span class="p">,</span> <span class="n">c15</span><span class="p">)]</span>  <span class="c1"># 26</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">26</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">t</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="n">cstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cstar</span><span class="o">*</span><span class="n">pi</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">omega</span><span class="p">)),</span>
                  <span class="n">c1</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c10</span><span class="p">,</span> <span class="n">c14</span><span class="p">,</span> <span class="n">c15</span><span class="p">)]</span>  <span class="c1"># 27</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">27</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Eq</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">s</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="n">cstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cstar</span><span class="o">*</span><span class="n">pi</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">omega</span><span class="p">)),</span>
                  <span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">omega</span><span class="p">))</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span>
                  <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c10</span><span class="p">,</span> <span class="n">c14</span><span class="p">,</span> <span class="n">c15</span><span class="p">)]</span>  <span class="c1"># 28</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">28</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span>
        <span class="n">p</span> <span class="o">&gt;</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Eq</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">t</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="n">cstar</span><span class="o">*</span><span class="n">pi</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">omega</span><span class="p">)),</span>
                  <span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">omega</span><span class="p">))</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span>
                  <span class="n">c1</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c10</span><span class="p">,</span> <span class="n">c14</span><span class="p">,</span> <span class="n">c15</span><span class="p">)]</span>  <span class="c1"># 29</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">29</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">s</span> <span class="o">+</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bstar</span><span class="o">.</span><span class="n">is_negative</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">t</span> <span class="o">-</span> <span class="n">u</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span>
                  <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c12</span><span class="p">,</span> <span class="n">c14</span><span class="p">,</span> <span class="n">c15</span><span class="p">)]</span>  <span class="c1"># 30</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">s</span> <span class="o">+</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">v</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bstar</span><span class="o">.</span><span class="n">is_negative</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">t</span> <span class="o">-</span> <span class="n">v</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span>
                  <span class="n">c1</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c12</span><span class="p">,</span> <span class="n">c14</span><span class="p">,</span> <span class="n">c15</span><span class="p">)]</span>  <span class="c1"># 31</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">31</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">m</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="n">bstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bstar</span><span class="o">*</span><span class="n">pi</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">sigma</span><span class="p">)),</span>
                  <span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">bstar</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span>
                  <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c12</span><span class="p">,</span> <span class="n">c14</span><span class="p">,</span> <span class="n">c15</span><span class="p">)]</span>  <span class="c1"># 32</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">n</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="n">bstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bstar</span><span class="o">*</span><span class="n">pi</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">sigma</span><span class="p">)),</span>
                  <span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">bstar</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span>
                  <span class="n">c1</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c12</span><span class="p">,</span> <span class="n">c14</span><span class="p">,</span> <span class="n">c15</span><span class="p">)]</span>  <span class="c1"># 33</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span>
        <span class="n">Eq</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">u</span> <span class="o">&lt;</span> <span class="n">v</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">bstar</span><span class="o">*</span><span class="n">pi</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">sigma</span><span class="p">)),</span>
        <span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">t</span> <span class="o">-</span> <span class="n">u</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span>
        <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c12</span><span class="p">,</span> <span class="n">c14</span><span class="p">,</span> <span class="n">c15</span><span class="p">)]</span>  <span class="c1"># 34</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">34</span><span class="p">)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span>
        <span class="n">Eq</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">u</span> <span class="o">&gt;</span> <span class="n">v</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cstar</span><span class="o">.</span><span class="n">is_positive</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">bstar</span><span class="o">*</span><span class="n">pi</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">sigma</span><span class="p">)),</span>
        <span class="nb">abs</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">t</span> <span class="o">-</span> <span class="n">v</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span>
        <span class="n">c1</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c12</span><span class="p">,</span> <span class="n">c14</span><span class="p">,</span> <span class="n">c15</span><span class="p">)]</span>  <span class="c1"># 35</span>
    <span class="n">pr</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Or</span><span class="p">(</span><span class="o">*</span><span class="n">conds</span><span class="p">)</span>

    <span class="c1"># NOTE An alternative, but as far as I can tell weaker, set of conditions</span>
    <span class="c1">#      can be found in [L, section 5.6.2].</span>


<span class="k">def</span> <span class="nf">_int0oo</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Express integral from zero to infinity g1*g2 using a G function,</span>
<span class="sd">    assuming the necessary conditions are fulfilled.</span>

<span class="sd">    &gt;&gt;&gt; from .meijerint import _int0oo</span>
<span class="sd">    &gt;&gt;&gt; from ..abc import s, t, m</span>
<span class="sd">    &gt;&gt;&gt; from .. import meijerg, S</span>
<span class="sd">    &gt;&gt;&gt; g1 = meijerg([], [], [-S(1)/2, 0], [], s**2*t/4)</span>
<span class="sd">    &gt;&gt;&gt; g2 = meijerg([], [], [m/2], [-m/2], t/4)</span>
<span class="sd">    &gt;&gt;&gt; _int0oo(g1, g2, t)</span>
<span class="sd">    4*meijerg(((1/2, 0), ()), ((m/2,), (-m/2,)), s**(-2))/s**2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># See: [L, section 5.6.2, equation (1)]</span>
    <span class="n">eta</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">g1</span><span class="o">.</span><span class="n">argument</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">omega</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">g2</span><span class="o">.</span><span class="n">argument</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">neg</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="o">-</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="n">neg</span><span class="p">(</span><span class="n">g1</span><span class="o">.</span><span class="n">bm</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">g2</span><span class="o">.</span><span class="n">an</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">g2</span><span class="o">.</span><span class="n">aother</span><span class="p">)</span> <span class="o">+</span> <span class="n">neg</span><span class="p">(</span><span class="n">g1</span><span class="o">.</span><span class="n">bother</span><span class="p">)</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="n">neg</span><span class="p">(</span><span class="n">g1</span><span class="o">.</span><span class="n">an</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">g2</span><span class="o">.</span><span class="n">bm</span><span class="p">)</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">g2</span><span class="o">.</span><span class="n">bother</span><span class="p">)</span> <span class="o">+</span> <span class="n">neg</span><span class="p">(</span><span class="n">g1</span><span class="o">.</span><span class="n">aother</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">meijerg</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">omega</span><span class="o">/</span><span class="n">eta</span><span class="p">)</span><span class="o">/</span><span class="n">eta</span>


<span class="k">def</span> <span class="nf">_rewrite_inversion</span><span class="p">(</span><span class="n">fac</span><span class="p">,</span> <span class="n">po</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Absorb ``po`` == x**s into g. &quot;&quot;&quot;</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">po</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">argument</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tr</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="n">s</span><span class="o">/</span><span class="n">b</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">powdenest</span><span class="p">(</span><span class="n">fac</span><span class="o">/</span><span class="n">a</span><span class="o">**</span><span class="p">(</span><span class="n">s</span><span class="o">/</span><span class="n">b</span><span class="p">),</span> <span class="n">polar</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">meijerg</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">an</span><span class="p">),</span> <span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">aother</span><span class="p">),</span> <span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">bm</span><span class="p">),</span> <span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">bother</span><span class="p">),</span> <span class="n">g</span><span class="o">.</span><span class="n">argument</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_check_antecedents_inversion</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Check antecedents for the laplace inversion integral. &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">re</span><span class="p">,</span> <span class="n">im</span><span class="p">,</span> <span class="n">Or</span><span class="p">,</span> <span class="n">And</span><span class="p">,</span> <span class="n">Eq</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">Add</span><span class="p">,</span> <span class="n">nan</span><span class="p">,</span> <span class="n">Ne</span>
    <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Checking antecedents for inversion:&#39;</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">argument</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">e</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;  Flipping G.&#39;</span><span class="p">)</span>
        <span class="c1"># We want to assume that argument gets large as |x| -&gt; oo</span>
        <span class="k">return</span> <span class="n">_check_antecedents_inversion</span><span class="p">(</span><span class="n">_flip_g</span><span class="p">(</span><span class="n">g</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">statement_half</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">plus</span><span class="p">):</span>
        <span class="n">coeff</span><span class="p">,</span> <span class="n">exponent</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">*=</span> <span class="n">exponent</span>
        <span class="n">b</span> <span class="o">*=</span> <span class="n">coeff</span><span class="o">**</span><span class="n">c</span>
        <span class="n">c</span> <span class="o">*=</span> <span class="n">exponent</span>
        <span class="n">conds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">wp</span> <span class="o">=</span> <span class="n">b</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="n">I</span><span class="o">*</span><span class="n">re</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">wm</span> <span class="o">=</span> <span class="n">b</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">I</span><span class="o">*</span><span class="n">re</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plus</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">wp</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">wm</span>
        <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">Or</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">re</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">re</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
        <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">Ne</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">im</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">re</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">re</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">Ne</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Eq</span><span class="p">(</span><span class="n">im</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">re</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">re</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span>
                      <span class="n">re</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">Or</span><span class="p">(</span><span class="o">*</span><span class="n">conds</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">statement</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Provide a convergence statement for z**a * exp(b*z**c),</span>
<span class="sd">             c/f sphinx docs. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">And</span><span class="p">(</span><span class="n">statement_half</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                   <span class="n">statement_half</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>

    <span class="c1"># Notations from [L], section 5.7-10</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">S</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">bm</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">an</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ap</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">bq</span><span class="p">)])</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="n">p</span>
    <span class="n">nu</span> <span class="o">=</span> <span class="n">q</span> <span class="o">-</span> <span class="n">m</span> <span class="o">-</span> <span class="n">n</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="p">(</span><span class="n">tau</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">q</span> <span class="o">-</span> <span class="n">p</span>
    <span class="k">if</span> <span class="n">sigma</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="k">elif</span> <span class="n">sigma</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="n">nan</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">sigma</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Add</span><span class="p">(</span><span class="o">*</span><span class="n">g</span><span class="o">.</span><span class="n">bq</span><span class="p">)</span> <span class="o">-</span> <span class="n">Add</span><span class="p">(</span><span class="o">*</span><span class="n">g</span><span class="o">.</span><span class="n">ap</span><span class="p">))</span><span class="o">/</span><span class="n">sigma</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">delta</span>
    <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;  m=</span><span class="si">%s</span><span class="s1">, n=</span><span class="si">%s</span><span class="s1">, p=</span><span class="si">%s</span><span class="s1">, q=</span><span class="si">%s</span><span class="s1">, tau=</span><span class="si">%s</span><span class="s1">, nu=</span><span class="si">%s</span><span class="s1">, rho=</span><span class="si">%s</span><span class="s1">, sigma=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">sigma</span><span class="p">))</span>
    <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;  epsilon=</span><span class="si">%s</span><span class="s1">, theta=</span><span class="si">%s</span><span class="s1">, delta=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">delta</span><span class="p">))</span>

    <span class="c1"># First check if the computation is valid.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">delta</span> <span class="o">&gt;=</span> <span class="n">e</span><span class="o">/</span><span class="mi">2</span> <span class="ow">or</span> <span class="p">(</span><span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">p</span> <span class="o">&gt;=</span> <span class="n">q</span><span class="p">)):</span>
        <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;  Computation not valid for these parameters.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Now check if the inversion integral exists.</span>

    <span class="c1"># Test &quot;condition A&quot;</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">an</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">bm</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">is_integer</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">:</span>
                <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;  Not a valid G function.&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># There are two cases. If p &gt;= q, we can directly use a slater expansion</span>
    <span class="c1"># like [L], 5.2 (11). Note in particular that the asymptotics of such an</span>
    <span class="c1"># expansion even hold when some of the parameters differ by integers, i.e.</span>
    <span class="c1"># the formula itself would not be valid! (b/c G functions are cts. in their</span>
    <span class="c1"># parameters)</span>
    <span class="c1"># When p &lt; q, we need to use the theorems of [L], 5.10.</span>

    <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;=</span> <span class="n">q</span><span class="p">:</span>
        <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;  Using asymptotic Slater expansion.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">And</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">statement</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">an</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">E</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">And</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">statement</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">an</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">H</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">statement</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="o">-</span><span class="n">sigma</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">sigma</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Hp</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">statement_half</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="o">-</span><span class="n">sigma</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">sigma</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Hm</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">statement_half</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="o">-</span><span class="n">sigma</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">sigma</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1"># [L], section 5.10</span>
    <span class="n">conds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Theorem 1</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">,</span> <span class="n">rho</span><span class="o">*</span><span class="n">pi</span> <span class="o">-</span> <span class="n">delta</span> <span class="o">&gt;=</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="n">E</span><span class="p">(</span><span class="n">z</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="n">I</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">nu</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))))]</span>
    <span class="c1"># Theorem 2, statements (2) and (3)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">q</span><span class="p">,</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span> <span class="o">-</span> <span class="n">delta</span> <span class="o">&gt;=</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                  <span class="n">Hp</span><span class="p">(</span><span class="n">z</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="n">I</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="n">m</span><span class="p">))),</span> <span class="n">Hm</span><span class="p">(</span><span class="n">z</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">I</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="n">m</span><span class="p">))))]</span>
    <span class="c1"># Theorem 2, statement (5)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">,</span> <span class="n">m</span> <span class="o">==</span> <span class="n">q</span><span class="p">,</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="p">(</span><span class="n">sigma</span> <span class="o">+</span> <span class="n">epsilon</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span> <span class="o">-</span> <span class="n">delta</span> <span class="o">&gt;=</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">H</span><span class="p">(</span><span class="n">z</span><span class="p">))]</span>
    <span class="c1"># Theorem 3, statements (6) and (7)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">Or</span><span class="p">(</span><span class="n">And</span><span class="p">(</span><span class="n">p</span> <span class="o">&lt;=</span> <span class="n">q</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">tau</span><span class="p">,</span> <span class="n">tau</span> <span class="o">&lt;=</span> <span class="n">sigma</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span>
                     <span class="n">And</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">m</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)),</span>
                  <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">tau</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span> <span class="o">-</span> <span class="n">delta</span> <span class="o">&gt;=</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                  <span class="n">Hp</span><span class="p">(</span><span class="n">z</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="n">I</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">nu</span><span class="p">)),</span> <span class="n">Hm</span><span class="p">(</span><span class="n">z</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">I</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">nu</span><span class="p">)))]</span>
    <span class="c1"># Theorem 4, statements (10) and (11)</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">And</span><span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">,</span> <span class="n">rho</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">delta</span> <span class="o">+</span> <span class="n">rho</span><span class="o">*</span><span class="n">pi</span> <span class="o">&lt;</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                  <span class="p">(</span><span class="n">tau</span> <span class="o">+</span> <span class="n">epsilon</span><span class="p">)</span><span class="o">*</span><span class="n">pi</span> <span class="o">-</span> <span class="n">delta</span> <span class="o">&gt;=</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                  <span class="n">Hp</span><span class="p">(</span><span class="n">z</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="n">I</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">nu</span><span class="p">)),</span> <span class="n">Hm</span><span class="p">(</span><span class="n">z</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">I</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">nu</span><span class="p">)))]</span>
    <span class="c1"># Trivial case</span>
    <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>

    <span class="c1"># TODO</span>
    <span class="c1"># Theorem 5 is quite general</span>
    <span class="c1"># Theorem 6 contains special cases for q=p+1</span>

    <span class="k">return</span> <span class="n">Or</span><span class="p">(</span><span class="o">*</span><span class="n">conds</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_int_inversion</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the laplace inversion integral, assuming the formula applies.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">argument</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">C</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">_inflate_fox_h</span><span class="p">(</span><span class="n">meijerg</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">an</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">aother</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">bm</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">bother</span><span class="p">,</span> <span class="n">b</span><span class="o">/</span><span class="n">t</span><span class="o">**</span><span class="n">a</span><span class="p">),</span> <span class="o">-</span><span class="n">a</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">C</span><span class="o">/</span><span class="n">t</span><span class="o">*</span><span class="n">g</span>


<span class="c1">####################################################################</span>
<span class="c1"># Finally, the real meat.</span>
<span class="c1">####################################################################</span>

<span class="n">_lookup_table</span> <span class="o">=</span> <span class="kc">None</span>


<span class="nd">@cacheit</span>
<span class="nd">@timeit</span>
<span class="k">def</span> <span class="nf">_rewrite_single</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Try to rewrite f as a sum of single G functions of the form</span>
<span class="sd">    C*x**s*G(a*x**b), where b is a rational number and C is independent of x.</span>
<span class="sd">    We guarantee that result.argument.as_coeff_mul(x) returns (a, (x**b,))</span>
<span class="sd">    or (a, ()).</span>
<span class="sd">    Returns a list of tuples (C, s, G) and a condition cond.</span>
<span class="sd">    Returns None on failure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">polarify</span><span class="p">,</span> <span class="n">unpolarify</span><span class="p">,</span> <span class="n">oo</span><span class="p">,</span> <span class="n">zoo</span><span class="p">,</span> <span class="n">Tuple</span>
    <span class="k">global</span> <span class="n">_lookup_table</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_lookup_table</span><span class="p">:</span>
        <span class="n">_lookup_table</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">_create_lookup_table</span><span class="p">(</span><span class="n">_lookup_table</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">meijerg</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">factor</span>
        <span class="n">coeff</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">factor</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">argument</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">as_coeff_mul</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">is_Pow</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">base</span> <span class="o">!=</span> <span class="n">x</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">m</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">is_Rational</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">m</span> <span class="o">!=</span> <span class="n">x</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">meijerg</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">an</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">aother</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">bm</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">bother</span><span class="p">,</span> <span class="n">coeff</span><span class="o">*</span><span class="n">m</span><span class="p">))],</span> <span class="kc">True</span>

    <span class="n">f_</span> <span class="o">=</span> <span class="n">f</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">_mytype</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">_lookup_table</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">_lookup_table</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">formula</span><span class="p">,</span> <span class="n">terms</span><span class="p">,</span> <span class="n">cond</span><span class="p">,</span> <span class="n">hint</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
            <span class="n">subs</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">old</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">subs</span><span class="p">:</span>
                <span class="n">subs_</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">fro</span><span class="p">,</span> <span class="n">to</span> <span class="ow">in</span> <span class="n">subs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">subs_</span><span class="p">[</span><span class="n">fro</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpolarify</span><span class="p">(</span><span class="n">polarify</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">lift</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                                            <span class="n">exponents_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">subs</span> <span class="o">=</span> <span class="n">subs_</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hint</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                    <span class="n">hint</span> <span class="o">=</span> <span class="n">hint</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">hint</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">BooleanAtom</span><span class="p">)):</span>
                    <span class="n">cond</span> <span class="o">=</span> <span class="n">unpolarify</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">subs</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">_eval_cond</span><span class="p">(</span><span class="n">cond</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">terms</span> <span class="o">=</span> <span class="n">terms</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span>
                <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">fac</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">:</span>
                    <span class="n">r1</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">unpolarify</span><span class="p">(</span><span class="n">fac</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span>
                                                   <span class="n">exponents_only</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="c1"># NOTE these substitutions can in principle introduce oo,</span>
                    <span class="c1">#      zoo and other absurdities. It shouldn&#39;t matter,</span>
                    <span class="c1">#      but better be safe.</span>
                    <span class="k">if</span> <span class="n">Tuple</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">r1</span> <span class="o">+</span> <span class="p">(</span><span class="n">g</span><span class="p">,)))</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">oo</span><span class="p">,</span> <span class="n">zoo</span><span class="p">,</span> <span class="o">-</span><span class="n">oo</span><span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="n">g</span> <span class="o">=</span> <span class="n">meijerg</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">an</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">aother</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">bm</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">bother</span><span class="p">,</span>
                                <span class="n">unpolarify</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">argument</span><span class="p">,</span> <span class="n">exponents_only</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r1</span> <span class="o">+</span> <span class="p">(</span><span class="n">g</span><span class="p">,))</span>
                <span class="k">if</span> <span class="n">res</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="n">cond</span>

    <span class="c1"># try recursive mellin transform</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">recursive</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Trying recursive Mellin transform method.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">.transforms</span> <span class="kn">import</span> <span class="p">(</span><span class="n">mellin_transform</span><span class="p">,</span>
                                    <span class="n">inverse_mellin_transform</span><span class="p">,</span> <span class="n">IntegralTransformError</span><span class="p">,</span>
                                    <span class="n">MellinTransformStripError</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">oo</span><span class="p">,</span> <span class="n">nan</span><span class="p">,</span> <span class="n">zoo</span><span class="p">,</span> <span class="n">simplify</span><span class="p">,</span> <span class="n">cancel</span>

    <span class="k">def</span> <span class="nf">my_imt</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">strip</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Calling simplify() all the time is slow and not helpful, since</span>
<span class="sd">            most of the time it only factors things in a way that has to be</span>
<span class="sd">            un-done anyway. But sometimes it can remove apparent poles. &quot;&quot;&quot;</span>
        <span class="c1"># XXX should this be in inverse_mellin_transform?</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">inverse_mellin_transform</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">strip</span><span class="p">,</span>
                                            <span class="n">as_meijerg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">needeval</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">MellinTransformStripError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">inverse_mellin_transform</span><span class="p">(</span>
                <span class="n">simplify</span><span class="p">(</span><span class="n">cancel</span><span class="p">(</span><span class="n">expand</span><span class="p">(</span><span class="n">F</span><span class="p">))),</span> <span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">strip</span><span class="p">,</span>
                <span class="n">as_meijerg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">needeval</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">f_</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">_dummy</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;rewrite-single&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="c1"># to avoid infinite recursion, we have to force the two g functions case</span>

    <span class="k">def</span> <span class="nf">my_integrator</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">Integral</span><span class="p">,</span> <span class="n">hyperexpand</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">_meijerint_definite_4</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">only_double</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">res</span><span class="p">,</span> <span class="n">cond</span> <span class="o">=</span> <span class="n">r</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">_my_unpolarify</span><span class="p">(</span><span class="n">hyperexpand</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">rewrite</span><span class="o">=</span><span class="s1">&#39;nonrepsmall&#39;</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">Piecewise</span><span class="p">((</span><span class="n">res</span><span class="p">,</span> <span class="n">cond</span><span class="p">),</span>
                             <span class="p">(</span><span class="n">Integral</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">oo</span><span class="p">)),</span> <span class="kc">True</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">Integral</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">oo</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">F</span><span class="p">,</span> <span class="n">strip</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mellin_transform</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">integrator</span><span class="o">=</span><span class="n">my_integrator</span><span class="p">,</span>
                                       <span class="n">simplify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">needeval</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">my_imt</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">strip</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">IntegralTransformError</span><span class="p">:</span>
        <span class="n">g</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">g</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># We try to find an expression by analytic continuation.</span>
        <span class="c1"># (also if the dummy is already in the expression, there is no point in</span>
        <span class="c1">#  putting in another one)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">_dummy_</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;rewrite-single&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">free_symbols</span> <span class="ow">and</span> <span class="n">_is_analytic</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">F</span><span class="p">,</span> <span class="n">strip</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mellin_transform</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="o">*</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span>
                                               <span class="n">integrator</span><span class="o">=</span><span class="n">my_integrator</span><span class="p">,</span>
                                               <span class="n">needeval</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">simplify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">g</span> <span class="o">=</span> <span class="n">my_imt</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">strip</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">IntegralTransformError</span><span class="p">:</span>
                <span class="n">g</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">g</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">g</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">oo</span><span class="p">,</span> <span class="n">nan</span><span class="p">,</span> <span class="n">zoo</span><span class="p">):</span>
        <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Recursive Mellin transform failed.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">Add</span><span class="o">.</span><span class="n">make_args</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">as_coeff_mul</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Unexpected form...&#39;</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">argument</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">meijerg</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">an</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">aother</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">bm</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">bother</span><span class="p">,</span>
                               <span class="n">unpolarify</span><span class="p">(</span><span class="n">polarify</span><span class="p">(</span>
                                   <span class="n">a</span><span class="p">,</span> <span class="n">lift</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">exponents_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                               <span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="n">b</span><span class="p">))]</span>
    <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Recursive Mellin transform worked:&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">_rewrite1</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Try to rewrite f using a (sum of) single G functions with argument a*x**b.</span>
<span class="sd">    Return fac, po, g such that f = fac*po*g, fac is independent of x</span>
<span class="sd">    and po = x**s.</span>
<span class="sd">    Here g is a result from _rewrite_single.</span>
<span class="sd">    Return None on failure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fac</span><span class="p">,</span> <span class="n">po</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">_split_mul</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">_rewrite_single</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">recursive</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">g</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fac</span><span class="p">,</span> <span class="n">po</span><span class="p">,</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_rewrite2</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Try to rewrite f as a product of two G functions of arguments a*x**b.</span>
<span class="sd">    Return fac, po, g1, g2 such that f = fac*po*g1*g2, where fac is</span>
<span class="sd">    independent of x and po is x**s.</span>
<span class="sd">    Here g1 and g2 are results of _rewrite_single.</span>
<span class="sd">    Returns None on failure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fac</span><span class="p">,</span> <span class="n">po</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">_split_mul</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">_rewrite_single</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">_mul_args</span><span class="p">(</span><span class="n">g</span><span class="p">)):</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">_mul_as_two_parts</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">l</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">l</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ordered</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="p">[</span>
        <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_exponents</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">)),</span> <span class="nb">len</span><span class="p">(</span><span class="n">_exponents</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">))),</span>
        <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_functions</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">)),</span> <span class="nb">len</span><span class="p">(</span><span class="n">_functions</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">))),</span>
        <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_find_splitting_points</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">)),</span>
                      <span class="nb">len</span><span class="p">(</span><span class="n">_find_splitting_points</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">)))]))</span>

    <span class="k">for</span> <span class="n">recursive</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">fac1</span><span class="p">,</span> <span class="n">fac2</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
            <span class="n">g1</span> <span class="o">=</span> <span class="n">_rewrite_single</span><span class="p">(</span><span class="n">fac1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">recursive</span><span class="p">)</span>
            <span class="n">g2</span> <span class="o">=</span> <span class="n">_rewrite_single</span><span class="p">(</span><span class="n">fac2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">recursive</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">g1</span> <span class="ow">and</span> <span class="n">g2</span><span class="p">:</span>
                <span class="n">cond</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="n">g1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">g2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">cond</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">fac</span><span class="p">,</span> <span class="n">po</span><span class="p">,</span> <span class="n">g1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">g2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cond</span>


<div class="viewcode-block" id="meijerint_indefinite"><a class="viewcode-back" href="../../../../modelparameters.sympy.integrals.html#modelparameters.sympy.integrals.meijerint.meijerint_indefinite">[docs]</a><span class="k">def</span> <span class="nf">meijerint_indefinite</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute an indefinite integral of ``f`` by rewriting it as a G function.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from .meijerint import meijerint_indefinite</span>
<span class="sd">    &gt;&gt;&gt; from .. import sin</span>
<span class="sd">    &gt;&gt;&gt; from ..abc import x</span>
<span class="sd">    &gt;&gt;&gt; meijerint_indefinite(sin(x), x)</span>
<span class="sd">    -cos(x)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">hyper</span><span class="p">,</span> <span class="n">meijerg</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">_find_splitting_points</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">|</span> <span class="p">{</span><span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span> <span class="n">key</span><span class="o">=</span><span class="n">default_sort_key</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">_meijerint_indefinite_1</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">a</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_has</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">hyper</span><span class="p">,</span> <span class="n">meijerg</span><span class="p">):</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>
    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">HyperbolicFunction</span><span class="p">):</span>
        <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Try rewriting hyperbolics in terms of exp.&#39;</span><span class="p">)</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="n">meijerint_indefinite</span><span class="p">(</span>
            <span class="n">_rewrite_hyperbolics_as_exp</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rv</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">rv</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">collect</span><span class="p">(</span><span class="n">factor_terms</span><span class="p">(</span><span class="n">rv</span><span class="p">),</span> <span class="n">rv</span><span class="o">.</span><span class="n">atoms</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">rv</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">results</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="n">ordered</span><span class="p">(</span><span class="n">results</span><span class="p">))</span></div>


<span class="k">def</span> <span class="nf">_meijerint_indefinite_1</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Helper that does not attempt any substitution. &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">Integral</span><span class="p">,</span> <span class="n">piecewise_fold</span><span class="p">,</span> <span class="n">nan</span><span class="p">,</span> <span class="n">zoo</span>
    <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Trying to compute the indefinite integral of&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="s1">&#39;wrt&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="n">gs</span> <span class="o">=</span> <span class="n">_rewrite1</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Note: the code that calls us will do expand() and try again</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">fac</span><span class="p">,</span> <span class="n">po</span><span class="p">,</span> <span class="n">gl</span><span class="p">,</span> <span class="n">cond</span> <span class="o">=</span> <span class="n">gs</span>
    <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39; could rewrite:&#39;</span><span class="p">,</span> <span class="n">gs</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">C</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">gl</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">argument</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">po</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">+=</span> <span class="n">s</span>

        <span class="c1"># we do a substitution t=a*x**b, get integrand fac*t**rho*g</span>
        <span class="n">fac_</span> <span class="o">=</span> <span class="n">fac</span> <span class="o">*</span> <span class="n">C</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">a</span><span class="o">**</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="n">b</span><span class="p">))</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="c1"># we now use t**rho*G(params, t) = G(params + rho, t)</span>
        <span class="c1"># [L, page 150, equation (4)]</span>
        <span class="c1"># and integral G(params, t) dt = G(1, params+1, 0, t)</span>
        <span class="c1">#   (or a similar expression with 1 and 0 exchanged ... pick the one</span>
        <span class="c1">#    which yields a well-defined function)</span>
        <span class="c1"># [R, section 5]</span>
        <span class="c1"># (Note that this dummy will immediately go away again, so we</span>
        <span class="c1">#  can safely pass S(1) for ``expr``.)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">_dummy</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;meijerint-indefinite&#39;</span><span class="p">,</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">tr</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">a</span> <span class="o">+</span> <span class="n">rho</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">p</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">is_integer</span> <span class="ow">and</span> <span class="p">(</span><span class="n">b</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">bm</span><span class="p">)):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="o">-</span><span class="n">meijerg</span><span class="p">(</span>
                <span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">an</span><span class="p">),</span> <span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">aother</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">bm</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">bother</span><span class="p">),</span> <span class="n">t</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">meijerg</span><span class="p">(</span>
                <span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">an</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">aother</span><span class="p">),</span> <span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">bm</span><span class="p">),</span> <span class="n">tr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">bother</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">)</span>
        <span class="c1"># The antiderivative is most often expected to be defined</span>
        <span class="c1"># in the neighborhood of  x = 0.</span>
        <span class="n">place</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">f</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">nan</span><span class="p">,</span> <span class="n">zoo</span><span class="p">):</span>
            <span class="n">place</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">hyperexpand</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="n">b</span><span class="p">),</span> <span class="n">place</span><span class="o">=</span><span class="n">place</span><span class="p">)</span>

        <span class="c1"># now substitute back</span>
        <span class="c1"># Note: we really do want the powers of x to combine.</span>
        <span class="n">res</span> <span class="o">+=</span> <span class="n">powdenest</span><span class="p">(</span><span class="n">fac_</span><span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="n">polar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_clean</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This multiplies out superfluous powers of x we created, and chops off</span>
<span class="sd">        constants:</span>

<span class="sd">            &gt;&gt; _clean(x*(exp(x)/x - 1/x) + 3)</span>
<span class="sd">            exp(x)</span>

<span class="sd">        cancel is used before mul_expand since it is possible for an</span>
<span class="sd">        expression to have an additive constant that doesn&#39;t become isolated</span>
<span class="sd">        with simple expansion. Such a situation was identified in issue 6369:</span>


<span class="sd">        &gt;&gt;&gt; from .. import sqrt, cancel</span>
<span class="sd">        &gt;&gt;&gt; from ..abc import x</span>
<span class="sd">        &gt;&gt;&gt; a = sqrt(2*x + 1)</span>
<span class="sd">        &gt;&gt;&gt; bad = (3*x*a**5 + 2*x - a**5 + 1)/a**2</span>
<span class="sd">        &gt;&gt;&gt; bad.expand().as_independent(x)[0]</span>
<span class="sd">        0</span>
<span class="sd">        &gt;&gt;&gt; cancel(bad).expand().as_independent(x)[0]</span>
<span class="sd">        1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">cancel</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">expand_mul</span><span class="p">(</span><span class="n">cancel</span><span class="p">(</span><span class="n">res</span><span class="p">),</span> <span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Add</span><span class="o">.</span><span class="n">_from_args</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">as_coeff_add</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">piecewise_fold</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">is_Piecewise</span><span class="p">:</span>
        <span class="n">newargs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">expr</span><span class="p">,</span> <span class="n">cond</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">_my_unpolarify</span><span class="p">(</span><span class="n">_clean</span><span class="p">(</span><span class="n">expr</span><span class="p">))</span>
            <span class="n">newargs</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">expr</span><span class="p">,</span> <span class="n">cond</span><span class="p">)]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">Piecewise</span><span class="p">(</span><span class="o">*</span><span class="n">newargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">_my_unpolarify</span><span class="p">(</span><span class="n">_clean</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Piecewise</span><span class="p">((</span><span class="n">res</span><span class="p">,</span> <span class="n">_my_unpolarify</span><span class="p">(</span><span class="n">cond</span><span class="p">)),</span> <span class="p">(</span><span class="n">Integral</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="kc">True</span><span class="p">))</span>


<div class="viewcode-block" id="meijerint_definite"><a class="viewcode-back" href="../../../../modelparameters.sympy.integrals.html#modelparameters.sympy.integrals.meijerint.meijerint_definite">[docs]</a><span class="nd">@timeit</span>
<span class="k">def</span> <span class="nf">meijerint_definite</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Integrate ``f`` over the interval [``a``, ``b``], by rewriting it as a product</span>
<span class="sd">    of two G functions, or as a single G function.</span>

<span class="sd">    Return res, cond, where cond are convergence conditions.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from .meijerint import meijerint_definite</span>
<span class="sd">    &gt;&gt;&gt; from .. import exp, oo</span>
<span class="sd">    &gt;&gt;&gt; from ..abc import x</span>
<span class="sd">    &gt;&gt;&gt; meijerint_definite(exp(-x**2), x, -oo, oo)</span>
<span class="sd">    (sqrt(pi), True)</span>

<span class="sd">    This function is implemented as a succession of functions</span>
<span class="sd">    meijerint_definite, _meijerint_definite_2, _meijerint_definite_3,</span>
<span class="sd">    _meijerint_definite_4. Each function in the list calls the next one</span>
<span class="sd">    (presumably) several times. This means that calling meijerint_definite</span>
<span class="sd">    can be very costly.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># This consists of three steps:</span>
    <span class="c1"># 1) Change the integration limits to 0, oo</span>
    <span class="c1"># 2) Rewrite in terms of G functions</span>
    <span class="c1"># 3) Evaluate the integral</span>
    <span class="c1">#</span>
    <span class="c1"># There are usually several ways of doing this, and we want to try all.</span>
    <span class="c1"># This function does (1), calls _meijerint_definite_2 for step (2).</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">arg</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">And</span><span class="p">,</span> <span class="n">DiracDelta</span><span class="p">,</span> <span class="n">SingularityFunction</span>
    <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Integrating&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="s1">&#39;wrt </span><span class="si">%s</span><span class="s1"> from </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">DiracDelta</span><span class="p">):</span>
        <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Integrand has DiracDelta terms - giving up.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">SingularityFunction</span><span class="p">):</span>
        <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Integrand has Singularity Function terms - giving up.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">f_</span><span class="p">,</span> <span class="n">x_</span><span class="p">,</span> <span class="n">a_</span><span class="p">,</span> <span class="n">b_</span> <span class="o">=</span> <span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>

    <span class="c1"># Let&#39;s use a dummy in case any of the boundaries has x.</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">Dummy</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">d</span>

    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">Zero</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="o">-</span><span class="n">oo</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">oo</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">meijerint_definite</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="o">-</span><span class="n">oo</span><span class="p">:</span>
        <span class="c1"># Integrating -oo to oo. We need to find a place to split the integral.</span>
        <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;  Integrating -oo to +oo.&#39;</span><span class="p">)</span>
        <span class="n">innermost</span> <span class="o">=</span> <span class="n">_find_splitting_points</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;  Sensible splitting points:&#39;</span><span class="p">,</span> <span class="n">innermost</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">innermost</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">default_sort_key</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)]:</span>
            <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;  Trying to split at&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">is_real</span><span class="p">:</span>
                <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;  Non-real splitting point.&#39;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">res1</span> <span class="o">=</span> <span class="n">_meijerint_definite_2</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">c</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">res1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;  But could not compute first integral.&#39;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">res2</span> <span class="o">=</span> <span class="n">_meijerint_definite_2</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span> <span class="o">-</span> <span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">res2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;  But could not compute second integral.&#39;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">res1</span><span class="p">,</span> <span class="n">cond1</span> <span class="o">=</span> <span class="n">res1</span>
            <span class="n">res2</span><span class="p">,</span> <span class="n">cond2</span> <span class="o">=</span> <span class="n">res2</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="n">_condsimp</span><span class="p">(</span><span class="n">And</span><span class="p">(</span><span class="n">cond1</span><span class="p">,</span> <span class="n">cond2</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">cond</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;  But combined condition is always false.&#39;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">res1</span> <span class="o">+</span> <span class="n">res2</span>
            <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="n">cond</span>

    <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="n">oo</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">meijerint_definite</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">oo</span><span class="p">)</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">oo</span><span class="p">):</span>
        <span class="c1"># This is a common case - try it directly first.</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">_meijerint_definite_2</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_has</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">meijerg</span><span class="p">):</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">res</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="n">oo</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">_find_splitting_points</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">split</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Trying x -&gt; x + </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">split</span><span class="p">)</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="n">_meijerint_definite_2</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">split</span><span class="p">)</span>
                                                <span class="o">*</span><span class="n">Heaviside</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">split</span> <span class="o">-</span> <span class="n">a</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">res</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">_has</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">meijerg</span><span class="p">):</span>
                            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">res</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">oo</span><span class="p">:</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">I</span><span class="o">*</span><span class="n">arg</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
            <span class="n">b</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">*=</span> <span class="n">Heaviside</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">phi</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">oo</span>

        <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Changed limits to&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Changed function to&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">_meijerint_definite_2</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_has</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">meijerg</span><span class="p">):</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">res</span>
    <span class="k">if</span> <span class="n">f_</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">HyperbolicFunction</span><span class="p">):</span>
        <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Try rewriting hyperbolics in terms of exp.&#39;</span><span class="p">)</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="n">meijerint_definite</span><span class="p">(</span>
            <span class="n">_rewrite_hyperbolics_as_exp</span><span class="p">(</span><span class="n">f_</span><span class="p">),</span> <span class="n">x_</span><span class="p">,</span> <span class="n">a_</span><span class="p">,</span> <span class="n">b_</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rv</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">rv</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">rv</span> <span class="o">=</span> <span class="p">(</span><span class="n">collect</span><span class="p">(</span><span class="n">factor_terms</span><span class="p">(</span><span class="n">rv</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">rv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">atoms</span><span class="p">(</span><span class="n">exp</span><span class="p">)),)</span> <span class="o">+</span> <span class="n">rv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">return</span> <span class="n">rv</span>
            <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">rv</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">results</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="n">ordered</span><span class="p">(</span><span class="n">results</span><span class="p">))</span></div>


<span class="k">def</span> <span class="nf">_guess_expansion</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Try to guess sensible rewritings for integrand f(x). &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">expand_trig</span>
    <span class="kn">from</span> <span class="nn">..functions.elementary.trigonometric</span> <span class="kn">import</span> <span class="n">TrigonometricFunction</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;original integrand&#39;</span><span class="p">)]</span>

    <span class="n">orig</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">saw</span> <span class="o">=</span> <span class="p">{</span><span class="n">orig</span><span class="p">}</span>
    <span class="n">expanded</span> <span class="o">=</span> <span class="n">expand_mul</span><span class="p">(</span><span class="n">orig</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">expanded</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">saw</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">expanded</span><span class="p">,</span> <span class="s1">&#39;expand_mul&#39;</span><span class="p">)]</span>
        <span class="n">saw</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">expanded</span><span class="p">)</span>

    <span class="n">expanded</span> <span class="o">=</span> <span class="n">expand</span><span class="p">(</span><span class="n">orig</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">expanded</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">saw</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">expanded</span><span class="p">,</span> <span class="s1">&#39;expand&#39;</span><span class="p">)]</span>
        <span class="n">saw</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">expanded</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">orig</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">TrigonometricFunction</span><span class="p">,</span> <span class="n">HyperbolicFunction</span><span class="p">):</span>
        <span class="n">expanded</span> <span class="o">=</span> <span class="n">expand_mul</span><span class="p">(</span><span class="n">expand_trig</span><span class="p">(</span><span class="n">orig</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">expanded</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">saw</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">expanded</span><span class="p">,</span> <span class="s1">&#39;expand_trig, expand_mul&#39;</span><span class="p">)]</span>
            <span class="n">saw</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">expanded</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">res</span>


<span class="k">def</span> <span class="nf">_meijerint_definite_2</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Try to integrate f dx from zero to infinty.</span>

<span class="sd">    The body of this function computes various &#39;simplifications&#39;</span>
<span class="sd">    f1, f2, ... of f (e.g. by calling expand_mul(), trigexpand()</span>
<span class="sd">    - see _guess_expansion) and calls _meijerint_definite_3 with each of</span>
<span class="sd">    these in succession.</span>
<span class="sd">    If _meijerint_definite_3 succeedes with any of the simplified functions,</span>
<span class="sd">    returns this result.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># This function does preparation for (2), calls</span>
    <span class="c1"># _meijerint_definite_3 for (2) and (3) combined.</span>

    <span class="c1"># use a positive dummy - we integrate from 0 to oo</span>
    <span class="c1"># XXX if a nonnegative symbol is used there will be test failures</span>
    <span class="n">dummy</span> <span class="o">=</span> <span class="n">_dummy</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;meijerint-definite2&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dummy</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">dummy</span>

    <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="kc">True</span>

    <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">explanation</span> <span class="ow">in</span> <span class="n">_guess_expansion</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Trying&#39;</span><span class="p">,</span> <span class="n">explanation</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">_meijerint_definite_3</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>


<span class="k">def</span> <span class="nf">_meijerint_definite_3</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Try to integrate f dx from zero to infinity.</span>

<span class="sd">    This function calls _meijerint_definite_4 to try to compute the</span>
<span class="sd">    integral. If this fails, it tries using linearity.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">_meijerint_definite_4</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">res</span> <span class="ow">and</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">res</span>
    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_Add</span><span class="p">:</span>
        <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Expanding and evaluating all terms.&#39;</span><span class="p">)</span>
        <span class="n">ress</span> <span class="o">=</span> <span class="p">[</span><span class="n">_meijerint_definite_4</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ress</span><span class="p">):</span>
            <span class="n">conds</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ress</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">r</span>
                <span class="n">conds</span> <span class="o">+=</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="o">*</span><span class="n">conds</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="n">c</span>


<span class="k">def</span> <span class="nf">_my_unpolarify</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">unpolarify</span>
    <span class="k">return</span> <span class="n">_eval_cond</span><span class="p">(</span><span class="n">unpolarify</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>


<span class="nd">@timeit</span>
<span class="k">def</span> <span class="nf">_meijerint_definite_4</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">only_double</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Try to integrate f dx from zero to infinity.</span>

<span class="sd">    This function tries to apply the integration theorems found in literature,</span>
<span class="sd">    i.e. it tries to rewrite f as either one or a product of two G-functions.</span>

<span class="sd">    The parameter ``only_double`` is used internally in the recursive algorithm</span>
<span class="sd">    to disable trying to rewrite f as a single G-function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># This function does (2) and (3)</span>
    <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Integrating&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="c1"># Try single G function.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">only_double</span><span class="p">:</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">_rewrite1</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fac</span><span class="p">,</span> <span class="n">po</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">cond</span> <span class="o">=</span> <span class="n">gs</span>
            <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Could rewrite as single G function:&#39;</span><span class="p">,</span> <span class="n">fac</span><span class="p">,</span> <span class="n">po</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">C</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">g</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">C</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">C</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">_rewrite_saxena_1</span><span class="p">(</span><span class="n">fac</span><span class="o">*</span><span class="n">C</span><span class="p">,</span> <span class="n">po</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="n">s</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">C</span><span class="o">*</span><span class="n">_int0oo_1</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="n">cond</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">_check_antecedents_1</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">cond</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="n">_my_unpolarify</span><span class="p">(</span><span class="n">cond</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cond</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;But cond is always False.&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Result before branch substitutions is:&#39;</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">_my_unpolarify</span><span class="p">(</span><span class="n">hyperexpand</span><span class="p">(</span><span class="n">res</span><span class="p">)),</span> <span class="n">cond</span>

    <span class="c1"># Try two G functions.</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">_rewrite2</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">full_pb</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]:</span>
            <span class="n">fac</span><span class="p">,</span> <span class="n">po</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">cond</span> <span class="o">=</span> <span class="n">gs</span>
            <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Could rewrite as two G functions:&#39;</span><span class="p">,</span> <span class="n">fac</span><span class="p">,</span> <span class="n">po</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">C1</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">f1</span> <span class="ow">in</span> <span class="n">g1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">C2</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">f2</span> <span class="ow">in</span> <span class="n">g2</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">_rewrite_saxena</span><span class="p">(</span><span class="n">fac</span><span class="o">*</span><span class="n">C1</span><span class="o">*</span><span class="n">C2</span><span class="p">,</span> <span class="n">po</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">s1</span> <span class="o">+</span> <span class="n">s2</span><span class="p">),</span>
                                        <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">full_pb</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Non-rational exponents.&#39;</span><span class="p">)</span>
                        <span class="k">return</span>
                    <span class="n">C</span><span class="p">,</span> <span class="n">f1_</span><span class="p">,</span> <span class="n">f2_</span> <span class="o">=</span> <span class="n">r</span>
                    <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Saxena subst for yielded:&#39;</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">f1_</span><span class="p">,</span> <span class="n">f2_</span><span class="p">)</span>
                    <span class="n">cond</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">_check_antecedents</span><span class="p">(</span><span class="n">f1_</span><span class="p">,</span> <span class="n">f2_</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">cond</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">res</span> <span class="o">+=</span> <span class="n">C</span><span class="o">*</span><span class="n">_int0oo</span><span class="p">(</span><span class="n">f1_</span><span class="p">,</span> <span class="n">f2_</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">break</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="n">_my_unpolarify</span><span class="p">(</span><span class="n">cond</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cond</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;But cond is always False (full_pb=</span><span class="si">%s</span><span class="s1">).&#39;</span> <span class="o">%</span> <span class="n">full_pb</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Result before branch substitutions is:&#39;</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">only_double</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="n">cond</span>
                <span class="k">return</span> <span class="n">_my_unpolarify</span><span class="p">(</span><span class="n">hyperexpand</span><span class="p">(</span><span class="n">res</span><span class="p">)),</span> <span class="n">cond</span>


<div class="viewcode-block" id="meijerint_inversion"><a class="viewcode-back" href="../../../../modelparameters.sympy.integrals.html#modelparameters.sympy.integrals.meijerint.meijerint_inversion">[docs]</a><span class="k">def</span> <span class="nf">meijerint_inversion</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the inverse laplace transform</span>
<span class="sd">    :math:\int_{c+i\infty}^{c-i\infty} f(x) e^{tx) dx,</span>
<span class="sd">    for real c larger than the real part of all singularities of f.</span>
<span class="sd">    Note that ``t`` is always assumed real and positive.</span>

<span class="sd">    Return None if the integral does not exist or could not be evaluated.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from ..abc import x, t</span>
<span class="sd">    &gt;&gt;&gt; from .meijerint import meijerint_inversion</span>
<span class="sd">    &gt;&gt;&gt; meijerint_inversion(1/x, x, t)</span>
<span class="sd">    Heaviside(t)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">I</span><span class="p">,</span> <span class="n">Integral</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">expand</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">Add</span><span class="p">,</span> <span class="n">Mul</span><span class="p">,</span> <span class="n">Heaviside</span>
    <span class="n">f_</span> <span class="o">=</span> <span class="n">f</span>
    <span class="n">t_</span> <span class="o">=</span> <span class="n">t</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">Dummy</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">polar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># We don&#39;t want sqrt(t**2) = abs(t) etc</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">t_</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Dummy</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
    <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Laplace-inverting&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_analytic</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;But expression is not analytic.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="c1"># We filter out exponentials here. If we are given an Add this will not</span>
    <span class="c1"># work, but the calling code will take care of that.</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_Mul</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="n">newargs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">exponentials</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">exp</span><span class="p">):</span>
                <span class="n">arg2</span> <span class="o">=</span> <span class="n">expand</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">arg2</span><span class="o">.</span><span class="n">is_Mul</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">+=</span> <span class="n">arg2</span><span class="o">.</span><span class="n">args</span>
                    <span class="k">continue</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">_CoeffExpValueError</span><span class="p">:</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">exponentials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">newargs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Pow</span><span class="p">:</span>
                <span class="n">arg2</span> <span class="o">=</span> <span class="n">expand</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">arg2</span><span class="o">.</span><span class="n">is_Mul</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">+=</span> <span class="n">arg2</span><span class="o">.</span><span class="n">args</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">arg</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">_get_coeff_exp</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">exp</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                    <span class="k">except</span> <span class="n">_CoeffExpValueError</span><span class="p">:</span>
                        <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">exponentials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">base</span><span class="p">))</span>
                <span class="n">newargs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newargs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="n">Add</span><span class="p">(</span><span class="o">*</span><span class="n">exponentials</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">Mul</span><span class="p">(</span><span class="o">*</span><span class="n">newargs</span><span class="p">)</span>

    <span class="n">gs</span> <span class="o">=</span> <span class="n">_rewrite1</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fac</span><span class="p">,</span> <span class="n">po</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">cond</span> <span class="o">=</span> <span class="n">gs</span>
        <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Could rewrite as single G function:&#39;</span><span class="p">,</span> <span class="n">fac</span><span class="p">,</span> <span class="n">po</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">C</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">g</span><span class="p">:</span>
            <span class="n">C</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">_rewrite_inversion</span><span class="p">(</span><span class="n">fac</span><span class="o">*</span><span class="n">C</span><span class="p">,</span> <span class="n">po</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="n">s</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="n">C</span><span class="o">*</span><span class="n">_int_inversion</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="n">And</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">_check_antecedents_inversion</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">cond</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">_my_unpolarify</span><span class="p">(</span><span class="n">cond</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cond</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;But cond is always False.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_debug</span><span class="p">(</span><span class="s1">&#39;Result before branch substitution:&#39;</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">_my_unpolarify</span><span class="p">(</span><span class="n">hyperexpand</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">Heaviside</span><span class="p">):</span>
                <span class="n">res</span> <span class="o">*=</span> <span class="n">Heaviside</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="n">shift</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="n">cond</span> <span class="o">=</span> <span class="n">cond</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="n">shift</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Piecewise</span><span class="p">((</span><span class="n">res</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t_</span><span class="p">),</span> <span class="n">cond</span><span class="p">),</span>
                             <span class="p">(</span><span class="n">Integral</span><span class="p">(</span><span class="n">f_</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">t</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span> <span class="o">-</span> <span class="n">oo</span><span class="o">*</span><span class="n">I</span><span class="p">,</span> <span class="n">c</span> <span class="o">+</span> <span class="n">oo</span><span class="o">*</span><span class="n">I</span><span class="p">))</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t_</span><span class="p">),</span> <span class="kc">True</span><span class="p">))</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">modelparameters 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">modelparameters.sympy.integrals.meijerint</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Johan Hake, Henrik Finsberg.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.3.
    </div>
  </body>
</html>